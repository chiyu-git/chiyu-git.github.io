---
layout: post
#æ ‡é¢˜é…ç½®
title:  è‡ªåŠ¨åŒ–æ„å»º
#æ—¶é—´é…ç½®
date:   2019-7-18 21:00:00 +0800
#å¤§ç±»é…ç½®
categories: document
#å°ç±»é…ç½®
tag: note front-end
---




# 1. é¡¹ç›®æ„å»º

### ä»€ä¹ˆæ˜¯é¡¹ç›®æ„å»º

+ ç¼–è¯‘é¡¹ç›®ä¸­çš„js, sass, less

+ åˆå¹¶js/cssç­‰èµ„æºæ–‡ä»¶

+ å‹ç¼©js/css/htmlç­‰èµ„æºæ–‡ä»¶

+ JSè¯­æ³•çš„æ£€æŸ¥

+ ......

### æ„å»ºå·¥å…·

+ Grunt

  + <http://www.gruntjs.net/>

  + http://www.cnblogs.com/wangfupeng1988/p/4561993.html(æ•™ç¨‹)

+ Gulp

  + <http://www.gulpjs.com.cn/>

  + http://www.jianshu.com/p/cc1cb9a5650c(æ•™ç¨‹)

  + http://www.ydcss.com/archives/category/%E6%9E%84%E5%BB%BA%E5%B7%A5%E5%85%B7 (è¯¦ç»†æ•™ç¨‹)

+ Webpack
  + http://webpack.github.io/ (è‹±æ–‡å®˜ç½‘)

  + http://guowenfh.github.io/2016/03/24/vue-webpack-01-base/(ç³»åˆ—æ•™ç¨‹)

  + https://github.com/nimojs/webpack-book(webpackå…¥é—¨æŒ‡å—)

  + http://www.jianshu.com/p/bb48898eded5(æ•™ç¨‹)

# 2. Grunt

## Gruntä»‹ç»

+ ä¸­æ–‡ä¸»é¡µ : http://www.gruntjs.net/

+ æ˜¯ä¸€å¥—å‰ç«¯è‡ªåŠ¨åŒ–æ„å»ºå·¥å…·ï¼Œä¸€ä¸ªåŸºäºnodeJsçš„å‘½ä»¤è¡Œå·¥å…·

+ å®ƒæ˜¯ä¸€ä¸ªä»»åŠ¡è¿è¡Œå™¨, é…åˆå…¶ä¸°å¯Œå¼ºå¤§çš„æ’ä»¶

+ å¸¸ç”¨åŠŸèƒ½:

  + åˆå¹¶æ–‡ä»¶

  + å‹ç¼©æ–‡ä»¶

  + è¯­æ³•æ£€æŸ¥

  + less/sassé¢„ç¼–è¯‘å¤„ç†ç­‰ç­‰

  + gruntæœ¬èº«ä¸é€‚é…es6è¯­æ³•ï¼Œéœ€è¦å…ˆç”¨Babelå¤„ç†ï¼Œä¸ç„¶ä¼šæŠ¥é”™

## Gruntå¸¸ç”¨æ’ä»¶

+ gruntå®˜ç½‘çš„æ’ä»¶åˆ—è¡¨é¡µé¢ http://www.gruntjs.net/plugins 

+ æ’ä»¶åˆ†ç±»:

  + gruntå›¢é˜Ÿè´¡çŒ®çš„æ’ä»¶ : æ’ä»¶åå¤§éƒ½ä»¥contrib-å¼€å¤´

  + ç¬¬ä¸‰æ–¹æä¾›çš„æ’ä»¶ : å¤§éƒ½ä¸ä»¥contrib-å¼€å¤´

+ å¸¸ç”¨çš„æ’ä»¶:

  + grunt-contrib-cleanâ€”â€”æ¸…é™¤æ–‡ä»¶(æ‰“åŒ…å¤„ç†ç”Ÿæˆçš„)

  + **grunt-contrib-concatâ€”â€”åˆå¹¶å¤šä¸ªæ–‡ä»¶çš„ä»£ç åˆ°ä¸€ä¸ªæ–‡ä»¶ä¸­**

  + **grunt-contrib-uglifyâ€”â€”å‹ç¼©jsæ–‡ä»¶**
  + **grunt-contrib-jshintâ€”â€”javascriptè¯­æ³•é”™è¯¯æ£€æŸ¥**
  + **grunt-contrib-cssminâ€”â€”å‹ç¼©åˆå¹¶cssæ–‡ä»¶**
  + **grunt-contrib-htmlminâ€”â€”å‹ç¼©htmlæ–‡ä»¶**
  + grunt-contrib-imageminâ€”â€”å‹ç¼©å›¾ç‰‡æ–‡ä»¶(æ— æŸ)
  + grunt-contrib-copyâ€”â€”å¤åˆ¶æ–‡ä»¶ã€æ–‡ä»¶å¤¹
  + **grunt-contrib-watchâ€”â€”å®æ—¶ç›‘æ§æ–‡ä»¶å˜åŒ–ã€è°ƒç”¨ç›¸åº”çš„ä»»åŠ¡é‡æ–°æ‰§è¡Œ**

## åˆ›å»ºä¸€ä¸ªç®€å•çš„gruntåº”ç”¨

+  å…¨å±€å®‰è£… grunt-cli
  + npm install -g grunt-cli 
+ å®‰è£…grunt
  + npm install grunt --save-dev

+ æ„å»ºé¡¹ç›®ç›®å½•
  + ![1553435543617](F:\OneDrive\JS\assets\1553435543617.png) 
+ ![1553435556104](F:\OneDrive\JS\assets\1553435556104.png) 
+ æ„å»ºé¡¹ç›®å‘½ä»¤ï¼ŒæŠŠé…ç½®ä¿¡æ¯æ’å…¥ç›¸åº”ä½ç½®
  + ![1553435578009](F:\OneDrive\JS\assets\1553435578009.png) 
+ åˆå¹¶jsï¼šä½¿ç”¨concatæ’ä»¶ï¼Œ
  + ![1553435592329](F:\OneDrive\JS\assets\1553435592329.png) 
+ å‹ç¼©js: ä½¿ç”¨uglifyæ’ä»¶
  + ![1553435601532](F:\OneDrive\JS\assets\1553435601532.png) 
  + å‹ç¼©é’ˆå¯¹åˆå¹¶çš„æ–‡ä»¶ï¼Œæ‰€ä»¥filesè·¯å¾„æ˜¯åˆå¹¶åç”Ÿæˆçš„built.js
  + ç”Ÿæˆçš„æ–‡ä»¶æ·»åŠ .min.ä½œä¸ºæ ‡ç¤º
  + å‹ç¼©æ“ä½œï¼šä¸€è¡Œï¼›å½¢å‚ç®€åŒ–ï¼›å®šä¹‰ä¸è°ƒç”¨çš„å‡½æ•°ç›´æ¥ç­›é€‰ï¼›
+ jsè¯­æ³•æ£€æŸ¥: ä½¿ç”¨jshintæ’ä»¶
  + ![1553435623015](F:\OneDrive\JS\assets\1553435623015.png) 
  + jshintæ’ä»¶æœ‰è‡ªå·±çš„é…ç½®æ–‡ä»¶.jshintrc éœ€è¦å…ˆé…ç½®å¥½ã€‚ç±»ä¼¼çš„.babelrcï¼Œæ˜¯ä¸€ä¸ªJSONæ–‡ä»¶
  + predef:æœ‰äº›å˜é‡æ˜¯ä¸ç”¨è‡ªå·±å®šä¹‰ï¼Œä¸€æ—¦å¼•å…¥äº†åº“å°±å¯ä»¥ï¼Œæ‰€ä»¥éœ€è¦æŒ‡ç¤ºä¸€ä¸‹
  + ![1553435754190](F:\OneDrive\JS\assets\1553435754190.png) 
+ åˆå¹¶å‹ç¼©cssæ–‡ä»¶ï¼Œä½¿ç”¨cssminæ’ä»¶
  + ![1553435768616](F:\OneDrive\JS\assets\1553435768616.png) 
  + ![1553435771573](F:\OneDrive\JS\assets\1553435771573.png) 
+ ä½¿ç”¨watchæ’ä»¶ï¼ˆçœŸæ­£å®ç°è‡ªåŠ¨åŒ–ï¼‰
  + ![1553435782776](F:\OneDrive\JS\assets\1553435782776.png) 
  + ç›‘è§†åŸæ–‡ä»¶ï¼Œä¸€æ—¦åŸæ–‡ä»¶å‘ç”Ÿäº†å˜åŒ–ï¼Œè‡ªåŠ¨æ‰§è¡Œtask
  + ![1553435795272](F:\OneDrive\JS\assets\1553435795272.png) 
  + ![1553435798949](F:\OneDrive\JS\assets\1553435798949.png) 
  + ![1553435802629](F:\OneDrive\JS\assets\1553435802629.png) 
  + æ³¨å†Œé»˜è®¤ä»»åŠ¡æ–¹ä¾¿ç»Ÿä¸€æ‰§è¡Œ
+ gruntæ‰§è¡Œä»»åŠ¡æ˜¯åŒæ­¥çš„ï¼ŒæŒ‰ä»»åŠ¡é¡ºåºæ‰§è¡Œï¼Œå…ˆå‹ç¼©ååˆå¹¶ä¼šç”Ÿæˆminã€‚æ–‡ä»¶è·¯å¾„çš„é—®é¢˜ï¼Œè¦å…ˆåˆå¹¶åœ¨å‹ç¼©ï¼Œå› ä¸ºå‹ç¼©çš„è·¯å¾„æŒ‡å®šçš„æ˜¯åˆå¹¶åçš„æ–‡ä»¶

# 3. Gulp

## Gulpä»‹ç»

+ ä¸­æ–‡ä¸»é¡µ: http://www.gulpjs.com.cn/

+ gulpæ˜¯ä¸gruntåŠŸèƒ½ç±»ä¼¼çš„å‰ç«¯é¡¹ç›®æ„å»ºå·¥å…·, ä¹Ÿæ˜¯åŸºäºNodejsçš„è‡ªåŠ¨ä»»åŠ¡è¿è¡Œå™¨

+ èƒ½è‡ªåŠ¨åŒ–åœ°å®Œæˆ javascript/coffee/sass/less/html/image/css ç­‰æ–‡ä»¶çš„åˆå¹¶ã€å‹ç¼©ã€æ£€æŸ¥ã€ç›‘å¬æ–‡ä»¶å˜åŒ–ã€æµè§ˆå™¨è‡ªåŠ¨åˆ·æ–°ã€æµ‹è¯•ç­‰ä»»åŠ¡

+ gulpæ›´é«˜æ•ˆ(**å¼‚æ­¥å¤šä»»åŠ¡**), æ›´æ˜“äºä½¿ç”¨, æ’ä»¶é«˜è´¨é‡

+ gulpçš„ç‰¹ç‚¹

  + ä»»åŠ¡åŒ–
  + åŸºäºæµ
  + æœ‰è‡ªå·±çš„å†…å­˜ï¼Œåœ¨I/Oæµå…¥æµå‡ºï¼Œå¤„ç†æ–‡ä»¶
  + å¼‚æ­¥/åŒæ­¥ä»»åŠ¡

  

### gulp.src(globs[, options])

+ è¾“å‡ºï¼ˆEmitsï¼‰ç¬¦åˆæ‰€æä¾›çš„åŒ¹é…æ¨¡å¼ï¼ˆglobï¼‰æˆ–è€…åŒ¹é…æ¨¡å¼çš„æ•°ç»„ï¼ˆarray of globsï¼‰çš„æ–‡ä»¶ã€‚ å°†è¿”å›ä¸€ä¸ª [Vinyl files](https://github.com/wearefractal/vinyl-fs) çš„ [stream](http://nodejs.org/api/stream.html) å®ƒå¯ä»¥è¢« [piped](http://nodejs.org/api/stream.html#stream_readable_pipe_destination_options) åˆ°åˆ«çš„æ’ä»¶ä¸­ã€‚

  ```js
  gulp.src('client/templates/*.jade')
   .pipe(jade())
   .pipe(minify()) 
   .pipe(gulp.dest('build/minified_templates'));
  ```

### gulp.dest(path[, options])

+ èƒ½è¢« pipe è¿›æ¥ï¼Œå¹¶ä¸”å°†ä¼šå†™æ–‡ä»¶ã€‚å¹¶ä¸”é‡æ–°è¾“å‡ºï¼ˆemitsï¼‰æ‰€æœ‰æ•°æ®ï¼Œå› æ­¤ä½ å¯ä»¥å°†å®ƒ pipe åˆ°å¤šä¸ªæ–‡ä»¶å¤¹ã€‚å¦‚æœæŸæ–‡ä»¶å¤¹ä¸å­˜åœ¨ï¼Œå°†ä¼šè‡ªåŠ¨åˆ›å»ºå®ƒã€‚

  ```js
  gulp.src('./client/templates/*.jade') 
  .pipe(jade()) 
  .pipe(gulp.dest('./build/templates')) 
  .pipe(minify()) .pipe(gulp.dest('./build/minified_templates'));
  ```

### gulp.task(name[, deps], fn)

+ å®šä¹‰ä¸€ä¸ªä½¿ç”¨ [Orchestrator](https://github.com/robrich/orchestrator) å®ç°çš„ä»»åŠ¡ï¼ˆtaskï¼‰

  ```js
  gulp.task('somename', function() { 
  // åšä¸€äº›äº‹
   });
  ```

### gulp.watch(glob [, opts],tasks) æˆ– gulp.watch(glob[, opts, cb])

+ ç›‘è§†æ–‡ä»¶ï¼Œå¹¶ä¸”å¯ä»¥åœ¨æ–‡ä»¶å‘ç”Ÿæ”¹åŠ¨æ—¶å€™åšä¸€äº›äº‹æƒ…ã€‚å®ƒæ€»ä¼šè¿”å›ä¸€ä¸ª EventEmitter æ¥å‘å°„ï¼ˆemitï¼‰ change äº‹ä»¶ã€‚

### å¸¸ç”¨çš„Gulpæ’ä»¶

+ gulp-concat : åˆå¹¶æ–‡ä»¶**(js/css)**

+ gulp-uglify : å‹ç¼©**js****æ–‡ä»¶**

+ gulp-rename : æ–‡ä»¶é‡å‘½åï¼ˆåœ¨åå­—ä¸­åŠ minï¼‰

+ gulp-less : ç¼–è¯‘less  //è½¬æ¢ä¸ºcssä»£ç 

+ gulp-clean-css : å‹ç¼©css

+ gulp-htmlminï¼šå‹ç¼©html

+ gulp-livereload : å®æ—¶è‡ªåŠ¨ç¼–è¯‘åˆ·æ–°

+ gulp-connectiï¼šçƒ­åŠ è½½ï¼Œå®æ—¶åŠ è½½ï¼ˆä¸ç”¨æ‰‹åŠ¨åˆ·æ–°æµè§ˆå™¨ï¼‰

+ gulp-load-pluginsï¼šä¸‹è½½æ‰“åŒ…æ’ä»¶

-       ä¸‹è½½æ’ä»¶:
        -       npm install gulp-concat gulp-uglify gulp-rename --save-dev
        -       åŒæ—¶ä¸‹è½½å¤šä¸ªåŒ…ï¼Œç”¨ç©ºæ ¼éš”å¼€å³å¯
-       å¼•å…¥æ’ä»¶
        -       var concat = require('gulp-concat');
        -       å¼•å…¥çš„æ’ä»¶éƒ½æ˜¯æ–¹æ³•
        -       concat(â€œæ–‡ä»¶å.jsâ€)
-       ä¸æ”¯æŒes6è¯­æ³•
-       å®šä¹‰æœªä½¿ç”¨çš„å˜é‡ï¼Œå‹ç¼©éƒ½ä¼šç­›é€‰æ‰
-       glupçš„é“¾å¼è°ƒç”¨ä¸jQueryä¸åŒï¼Œç»§ç»­æ‰§è¡Œçš„æ˜¯ä¸Šä¸€ä¸ªè¿”å›çš„æ–‡ä»¶è€Œä¸æ˜¯æœ€åˆè°ƒç”¨çš„ï¼Œå‹ç¼©çš„æ˜¯åˆå¹¶åçš„ï¼Œè€Œä¸æ˜¯åˆå§‹ï¼Œ**å°±æ˜¯ç®¡é“å’¯**

## åˆ›å»ºä¸€ä¸ªç®€å•çš„Gulpåº”ç”¨

+ æ–‡æ¡£ç»“æ„

  + ![1553436242619](F:\OneDrive\JS\assets\1553436242619.png) 

+ å®‰è£…gulp:

  + å…¨å±€å®‰è£…gulp
  + npm install gulp -g
  + å±€éƒ¨å®‰è£…gulp
  + npm install gulp --save-dev

+ é…ç½®ç¼–ç : gulpfile.js

  ```js
  //å¼•å…¥gulpæ¨¡å—
  var gulp = require('gulp');
  //å®šä¹‰ä»»åŠ¡
  gulp.task('ä»»åŠ¡å', function() {
    // å°†ä½ çš„ä»»åŠ¡çš„ä»»åŠ¡ä»£ç æ”¾åœ¨è¿™
  });
  //æ³¨å†Œé»˜è®¤ä»»åŠ¡
  gulp.task('default', ['ä»»åŠ¡å'])//å¼‚æ­¥æ‰§è¡Œ
  ```

+ ç¼–å†™jsæ–‡ä»¶

  + ![1553436276887](F:\OneDrive\JS\assets\1553436276887.png) 

+ é…ç½®æ–‡ä»¶ï¼šä»»åŠ¡ç¼–ç 

  ```js
  var concat = require('gulp-concat'); //å¼•å…¥æ’ä»¶
  var uglify = require('gulp-uglify');
  var rename = require('gulp-rename');
  gulp.task('minifyjs', function() {
      return gulp.src('src/js/*.js') //æ“ä½œçš„æºæ–‡ä»¶ **/*.jsæ·±åº¦éå†
          .pipe(concat('built.js')) //åˆå¹¶åˆ°ä¸´æ—¶æ–‡ä»¶     
          .pipe(gulp.dest('dist/js')) //ç”Ÿæˆåˆ°ç›®æ ‡æ–‡ä»¶å¤¹
          .pipe(rename({suffix: '.min'})) //é‡å‘½å  
          .pipe(uglify())    //å‹ç¼©
          .pipe(gulp.dest('dist/js')); //æŠŠå‹ç¼©åçš„æ–‡ä»¶
  });
  
  gulp.task('default', ['minifyjs']);
  ```

+ é¡µé¢å¼•å…¥jsæµè§ˆæµ‹è¯• : index.html

+ å¤„ç†CSS

  ```js
  var less = require('gulp-less');
  var cleanCSS = require('gulp-clean-css');
  
  //lesså¤„ç†ä»»åŠ¡
  gulp.task('lessTask', function () {
    return gulp.src('src/less/*.less')
        .pipe(less()) 
        
        .pipe(gulp.dest('src/css')); //è¾“å‡ºåˆ°cssæ–‡ä»¶ï¼Œæ–¹ä¾¿ä¸€èµ·åˆå¹¶å‹ç¼©
  })
  //csså¤„ç†ä»»åŠ¡, æŒ‡å®šä¾èµ–çš„ä»»åŠ¡,ä¾èµ–ä»»åŠ¡ä¼˜å…ˆå¤„ç†
  gulp.task('cssTask',['lessTask'], function () {
  
    return gulp.src('src/css/*.css')
        .pipe(concat('built.css'))
        .pipe(gulp.dest('dist/css'))
        .pipe(rename({suffix: '.min'}))
        .pipe(cleanCSS({compatibility: 'ie8'})) //å…¼å®¹è‡³ie8
        .pipe(gulp.dest('dist/css'));
  });
  
  gulp.task('default', ['minifyjs', 'cssTask']);
  ```

+ å¤„ç†html

  ```js
  var htmlmin = require('gulp-htmlmin');
    //å‹ç¼©htmlä»»åŠ¡
    gulp.task('htmlMinify', function() {
        return gulp.src('index.html')
  //æ¶ˆé™¤ç©ºæ ¼
            .pipe(htmlmin({collapseWhitespace: true}))
            .pipe(gulp.dest('dist'));//æ–‡ä»¶ä½ç½®å˜åŒ–ï¼Œå¼•å…¥ä»£ç å˜åŒ–
    });
    gulp.task('default', ['minifyjs', 'cssTask', 'htmlMinify']);
  ```
  ä¿®æ”¹é¡µé¢å¼•å…¥
    ```
    <link rel="stylesheet" href="css/built.min.css">
    <script type="text/javascript" src="js/built.min.js"></script>
    ```
   æ‰“åŒ…æµ‹è¯•: gulp    

  ```
  
  ```

+ è‡ªåŠ¨ç¼–è¯‘ï¼ˆéœ€è¦æ‰‹åŠ¨åˆ·æ–°æµè§ˆå™¨ï¼‰

  ```js
  var livereload = require('gulp-livereload');
  //æ‰€æœ‰çš„pipe
  .pipe(livereload());
  //ä¾èµ–ä»»åŠ¡defaultï¼Œå…ˆå¯åŠ¨ï¼Œç”¨äºç›‘è§†
  gulp.task('watch', ['default'], function () {    
    //å¼€å¯ç›‘è§†
    livereload.listen();
    //ç›‘è§†æŒ‡å®šçš„æ–‡ä»¶, å¹¶æŒ‡å®šå¯¹åº”çš„å¤„ç†ä»»åŠ¡
    gulp.watch('src/js/*.js', ['minifyjs'])
  //cssTaskä¾èµ–äºlessTaskï¼Œæ‰€ä»¥ä¸€ä¸ªå°±å¤Ÿ
    gulp.watch(['src/css/*.css','src/less/*.less'], ['cssTask']);
  });
  ```

+ çƒ­åŠ è½½ï¼ˆè‡ªåŠ¨åˆ·æ–°æµè§ˆå™¨ï¼‰

  ```js
  1ã€npm install gulp-connect --save-dev
  2ã€æ³¨å†Œ çƒ­åŠ è½½çš„ä»»åŠ¡ serverï¼Œæ³¨æ„ä¾èµ–buildä»»åŠ¡
  3ã€æ³¨å†Œ çƒ­åŠ è½½çš„ä»»åŠ¡
      //é…ç½®åŠ è½½çš„é€‰é¡¹ï¼Œæ’ä»¶å†…ç½®çš„å¾®å‹æœåŠ¡å™¨ï¼Œè‡ªåŠ¨è¯»å–gulpfile.jsé…ç½®æ–‡ä»¶
      //æŠŠæ‰€æœ‰çš„æ“ä½œéƒ½åœ¨è‡ªå·±çš„å¾®å‹æœåŠ¡å™¨æ‰§è¡Œï¼Œæä¾›ä¸€ä¸ªå¯è®¿é—®çš„æœåŠ¡å™¨åœ°å€
      connect.server({
            root : 'dist/',//æä¾›æœåŠ¡çš„æ ¹è·¯å¾„
            livereload : true,//æ˜¯å¦å®æ—¶åˆ·æ–°
            port : 5000//å¼€å¯ç«¯å£å·ï¼Œlocalhost:5000ç”¨äºè®¿é—®
       });
       //æ¯ä¸ªä»»åŠ¡ä¸‹æ·»åŠ .pipe(connect.reload())
       // openæ’ä»¶å¯ä»¥è‡ªåŠ¨å¼€å¯é“¾æ¥
       open('http://localhost:5000');//npm install open --save-dev
       // ç›‘è§†ç›®æ ‡æ–‡ä»¶
      gulp.watch('src/js/*.js', ['js']);
      gulp.watch(['src/css/*.css', 'src/css/*.less'], ['cssMin', 'less']);
  ```

+ æ‰©å±•

+ æ‰“åŒ…åŠ è½½gulpæ’ä»¶

+ å‰æï¼šå°†æ’ä»¶ä¸‹è½½å¥½ã€‚

+ è½½æ‰“åŒ…æ’ä»¶ï¼š gulp-load-plugins

  ```js
  *å¼•å…¥ï¼š var $ = require('gulp-load-plugins')();
  //å¼•å…¥çš„æ’ä»¶æ˜¯ä¸ªæ–¹æ³•ï¼Œå¿…é¡»è®°ä½è°ƒç”¨ã€‚
  //ç¥æ¥ä¹‹ç¬”ï¼šå…¶ä»–çš„æ’ä»¶ä¸ç”¨å†å¼•å…¥äº†
  ä½¿ç”¨æ–¹æ³•ï¼š
  //æ‰€æœ‰çš„æ’ä»¶ç”¨ $ å¼•å‡ºï¼Œå…¶ä»–æ’ä»¶çš„æ–¹æ³•åç»Ÿä¸€ä¸ºæ’ä»¶çš„åŠŸèƒ½åå­—(å³æ’ä»¶åå­—çš„æœ€åä¸€éƒ¨åˆ†) å¦‚ï¼šconcat,connect,cssmin...
  //é»˜è®¤çš„æ–¹æ³•åå°±æ˜¯æ’ä»¶åï¼š
  //gulp-htmlmin â†’ $.htmlmin ä¸éœ€è¦é©¼å³°å‘½å
  //gulp-clean-css â†’ $.cleanCss
  gulp.task('lib', function() {
    gulp.src('bower_components/**/*.js')
      .pipe(gulp.dest(app.devPath + 'vendor'))
      .pipe(gulp.dest(app.prdPath + 'vendor'))
      .pipe($.connect.reload());
  });
  ```

+ gulpä»»åŠ¡é»˜è®¤å¼‚æ­¥æ‰§è¡Œï¼Œå¦‚æœåœ¨å£°æ˜ä»»åŠ¡æ—¶ä¸ç”¨returnï¼Œåˆ™ä¼šå˜æˆåŒæ­¥æ‰§è¡Œã€‚ä½¿ç”¨returnå¼‚æ­¥æ‰§è¡Œçš„åŒæ—¶ï¼Œè¿˜ä¼šåœ¨ä»»åŠ¡æ‰§è¡Œå®Œæ¯•ä¹‹åå°†å†…å­˜é‡Šæ”¾

# webpack

+ https://github.com/gwuhaolin/dive-into-webpack/

## åŸºæœ¬æ¦‚å¿µ

+ webpack æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªæ‰“åŒ…å·¥å…·ï¼Œå®ƒä¼šæ ¹æ®ä»£ç çš„å†…å®¹è§£ææ¨¡å—ä¾èµ–ï¼Œå¸®åŠ©æˆ‘ä»¬æŠŠå¤šä¸ªæ¨¡å—çš„ä»£ç æ‰“åŒ…

  > è€Œgruntå’Œgulpä»…ä»…æ˜¯é¡¹ç›®æ„å»ºå·¥å…·

+ webpack ä¼šæŠŠæˆ‘ä»¬é¡¹ç›®ä¸­ä½¿ç”¨åˆ°çš„å¤šä¸ªä»£ç æ¨¡å—ï¼ˆå¯ä»¥æ˜¯ä¸åŒæ–‡ä»¶ç±»å‹ï¼‰ï¼Œæ‰“åŒ…æ„å»ºæˆé¡¹ç›®è¿è¡Œä»…éœ€è¦çš„å‡ ä¸ªé™æ€æ–‡ä»¶

+ åœ¨Webpackçœ‹æ¥, å‰ç«¯çš„æ‰€æœ‰èµ„æºæ–‡ä»¶(js/json/css/img/less/...)éƒ½ä¼šä½œä¸ºæ¨¡å—å¤„ç†ï¼Œé™¤äº†html

+ å®ƒå°†æ ¹æ®æ¨¡å—çš„ä¾èµ–å…³ç³»è¿›è¡Œé™æ€åˆ†æï¼Œç”Ÿæˆå¯¹åº”çš„é™æ€èµ„æº

+ å†…ç½®æ”¯æŒcommonJSã€ES6ã€AMDä¸‰ç§æ¨¡å—åŒ–è§„èŒƒ

### é…ç½®æ–‡ä»¶(é»˜è®¤)

- webpack.config.js : æ˜¯ä¸€ä¸ªnodeæ¨¡å—ï¼Œè¿”å›ä¸€ä¸ª json æ ¼å¼çš„é…ç½®ä¿¡æ¯å¯¹è±¡

  > ç±»ä¼¼äºgruntfile.jså’Œgulpfile.js

- å…¥å£ è¾“å‡º loader plugin ç­‰ç›¸å…³é…ç½®å…¨éƒ½æ˜¯åœ¨webpack.config.jså†…è®¾ç½®

### å…¥å£

+ å…¥å£å¯ä»¥ä½¿ç”¨ `entry`å­—æ®µæ¥è¿›è¡Œé…ç½®ï¼Œ`webpack` æ”¯æŒé…ç½®å¤šä¸ªå…¥å£æ¥è¿›è¡Œæ„å»º

  ```js
  module.exports = {
    entry: './src/index.js' 
  }
  
  // ä¸Šè¿°é…ç½®ç­‰åŒäº
  module.exports = {
    entry: {
      main: './src/index.js'
    }
  }
  
  // æˆ–è€…é…ç½®å¤šä¸ªå…¥å£
  module.exports = {
    entry: {
      foo: './src/page-foo.js',
      bar: './src/page-bar.js', 
      // ...
    }
  }
  
  // ä½¿ç”¨æ•°ç»„æ¥å¯¹å¤šä¸ªæ–‡ä»¶è¿›è¡Œæ‰“åŒ…
  module.exports = {
    entry: {
      main: [
        './src/foo.js',
        './src/bar.js'
      ]
    }
  }...
  ```

### loader

+ Webpack æœ¬èº«åªèƒ½åŠ è½½JS/JSONæ¨¡å—ï¼Œå¦‚æœè¦åŠ è½½å…¶ä»–ç±»å‹çš„æ–‡ä»¶(æ¨¡å—)ï¼Œå°±éœ€è¦ä½¿ç”¨å¯¹åº”çš„loader è¿›è¡Œè½¬æ¢/åŠ è½½

+ Loader æœ¬èº«ä¹Ÿæ˜¯è¿è¡Œåœ¨ node.js ç¯å¢ƒä¸­çš„ JavaScript æ¨¡å—

+ å®ƒæœ¬èº«æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œæ¥å—æºæ–‡ä»¶ä½œä¸ºå‚æ•°ï¼Œè¿”å›è½¬æ¢çš„ç»“æœ

+ loader ä¸€èˆ¬ä»¥ xxx-loader çš„æ–¹å¼å‘½åï¼Œxxx ä»£è¡¨äº†è¿™ä¸ª loader è¦åšçš„è½¬æ¢åŠŸèƒ½ï¼Œæ¯”å¦‚ json-loader

+ å¯ä»¥æŠŠ `loader`ç†è§£ä¸ºæ˜¯ä¸€ä¸ªè½¬æ¢å™¨ï¼Œè´Ÿè´£æŠŠæŸç§æ–‡ä»¶æ ¼å¼çš„å†…å®¹è½¬æ¢æˆ webpack å¯ä»¥æ”¯æŒæ‰“åŒ…çš„**æ¨¡å—**

+ å½“æˆ‘ä»¬éœ€è¦ä½¿ç”¨ä¸åŒçš„ `loader` æ¥è§£æå¤„ç†ä¸åŒç±»å‹çš„æ–‡ä»¶æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ `module.rules` å­—æ®µä¸‹æ¥é…ç½®ç›¸å…³çš„è§„åˆ™ï¼Œä¾‹å¦‚ä½¿ç”¨ `Babel` æ¥å¤„ç† `.js` æ–‡ä»¶

  ```js
  module: {
    // ...
    rules: [
      {
        test: /\.jsx?/, // åŒ¹é…æ–‡ä»¶è·¯å¾„çš„æ­£åˆ™è¡¨è¾¾å¼ï¼Œé€šå¸¸æˆ‘ä»¬éƒ½æ˜¯åŒ¹é…æ–‡ä»¶ç±»å‹åç¼€
        include: [
          path.resolve(__dirname, 'src') // æŒ‡å®šå“ªäº›è·¯å¾„ä¸‹çš„æ–‡ä»¶éœ€è¦ç»è¿‡ loader å¤„ç†
        ],
        use: 'babel-loader', // æŒ‡å®šä½¿ç”¨çš„ loader
      },
    ],
  }...
  ```

### plugin

+ æ¨¡å—ä»£ç è½¬æ¢çš„å·¥ä½œç”± `loader` æ¥å¤„ç†ï¼Œé™¤æ­¤ä¹‹å¤–çš„å…¶ä»–ä»»ä½•å·¥ä½œéƒ½å¯ä»¥äº¤ç”± `plugin` æ¥å®Œæˆã€‚

+ é€šè¿‡æ·»åŠ æˆ‘ä»¬éœ€è¦çš„ `plugin`ï¼Œå¯ä»¥æ»¡è¶³æ›´å¤šæ„å»ºä¸­ç‰¹æ®Šçš„éœ€æ±‚ã€‚ä¾‹å¦‚ï¼Œè¦ä½¿ç”¨å‹ç¼© `JS`ä»£ç çš„ `uglifyjs-webpack-plugin`æ’ä»¶ï¼Œåªéœ€åœ¨é…ç½®ä¸­é€šè¿‡ `plugins`å­—æ®µæ·»åŠ æ–°çš„ `plugin`å³å¯

  ```js
  const UglifyPlugin = require('uglifyjs-webpack-plugin')
  
  module.exports = {
    plugins: [
      new UglifyPlugin()
    ],
  }
  ```

+ `plugin` ç†è®ºä¸Šå¯ä»¥å¹²æ¶‰ `webpack` æ•´ä¸ªæ„å»ºæµç¨‹ï¼Œå¯ä»¥åœ¨æµç¨‹çš„æ¯ä¸€ä¸ªæ­¥éª¤ä¸­å®šåˆ¶è‡ªå·±çš„æ„å»ºéœ€æ±‚

### è¾“å‡º

+ æ„å»ºç»“æœçš„æ–‡ä»¶åã€è·¯å¾„ç­‰éƒ½æ˜¯å¯ä»¥é…ç½®çš„ï¼Œä½¿ç”¨ `output`å­—æ®µ

  ```js
  module.exports = {
    // ...
    output: {
      path: path.resolve(__dirname, 'dist'),
      filename: 'bundle.js',
    },
  }
  
  // æˆ–è€…å¤šä¸ªå…¥å£ç”Ÿæˆä¸åŒæ–‡ä»¶
  module.exports = {
    entry: {
      foo: './src/foo.js',
      bar: './src/bar.js',
    },
    output: {
      filename: '[name].js',
      path: __dirname + '/dist',
    },
  }
  
  // è·¯å¾„ä¸­ä½¿ç”¨ hashï¼Œæ¯æ¬¡æ„å»ºæ—¶ä¼šæœ‰ä¸€ä¸ªä¸åŒ hash å€¼ï¼Œé¿å…å‘å¸ƒæ–°ç‰ˆæœ¬æ—¶çº¿ä¸Šä½¿ç”¨æµè§ˆå™¨ç¼“å­˜
  module.exports = {
    // ...
    output: {
      filename: '[name].js',
      path: __dirname + '/dist/[hash]',
    },
  }...
  ```

+ æˆ‘ä»¬ä¸€å¼€å§‹ç›´æ¥ä½¿ç”¨ `webpack` æ„å»ºæ—¶ï¼Œé»˜è®¤åˆ›å»ºçš„è¾“å‡ºå†…å®¹å°±æ˜¯ `./dist/main.js`

### ä¸€ä¸ªç®€å•çš„webpackåº”ç”¨

+ `webpack` è¿è¡Œæ—¶é»˜è®¤è¯»å–é¡¹ç›®ä¸‹çš„ `webpack.config.js` æ–‡ä»¶ä½œä¸ºé…ç½®ã€‚æ‰€ä»¥æˆ‘ä»¬åœ¨é¡¹ç›®ä¸­åˆ›å»ºä¸€ä¸ª `webpack.config.js` æ–‡ä»¶

  ```js
  const path = require('path')
  const UglifyPlugin = require('uglifyjs-webpack-plugin')
  
  module.exports = {
    entry: './src/index.js',
  
    output: {
      path: path.resolve(__dirname, 'dist'),
      filename: 'bundle.js',
    },
  
    module: {
      rules: [
        {
          test: /\.jsx?/,
          include: [
            path.resolve(__dirname, 'src')
          ],
          use: 'babel-loader',
        },
      ],
    },
  
    // ä»£ç æ¨¡å—è·¯å¾„è§£æçš„é…ç½®
    resolve: {
      modules: [
        "node_modules",
        path.resolve(__dirname, 'src')
      ],
  	// è‡ªåŠ¨æ·»åŠ æ¨¡å—åç¼€å
      extensions: [".wasm", ".mjs", ".js", ".json", ".jsx"],
    },
  
    plugins: [
      new UglifyPlugin(), 
      // ä½¿ç”¨ uglifyjs-webpack-plugin æ¥å‹ç¼© JS ä»£ç 
      // å¦‚æœä½ ç•™æ„äº†æˆ‘ä»¬ä¸€å¼€å§‹ç›´æ¥ä½¿ç”¨ webpack æ„å»ºçš„ç»“æœï¼Œä½ ä¼šå‘ç°é»˜è®¤å·²ç»ä½¿ç”¨äº† JS ä»£ç å‹ç¼©çš„æ’ä»¶
      // è¿™å…¶å®ä¹Ÿæ˜¯æˆ‘ä»¬å‘½ä»¤ä¸­çš„ --mode production çš„æ•ˆæœï¼Œåç»­çš„å°èŠ‚ä¼šä»‹ç» webpack çš„ mode å‚æ•°
    ],
  }...
  ```

## æ­å»ºåŸºç¡€çš„å‰ç«¯å¼€å‘ç¯å¢ƒ

### å…³è” HTML

+ `webpack` é»˜è®¤ä»ä½œä¸ºå…¥å£çš„ `.js` æ–‡ä»¶è¿›è¡Œæ„å»ºï¼ˆæ›´å¤šæ˜¯åŸºäº `SPA` å»è€ƒè™‘ï¼‰ï¼Œä½†é€šå¸¸ä¸€ä¸ªå‰ç«¯é¡¹ç›®éƒ½æ˜¯ä»ä¸€ä¸ªé¡µé¢ï¼ˆå³ HTMLï¼‰å‡ºå‘çš„ï¼Œæœ€ç®€å•çš„æ–¹æ³•æ˜¯ï¼Œåˆ›å»ºä¸€ä¸ª HTML æ–‡ä»¶ï¼Œä½¿ç”¨ `script` æ ‡ç­¾ç›´æ¥å¼•ç”¨æ„å»ºå¥½çš„ JS æ–‡ä»¶ï¼Œå¦‚â€¦

  ```html
  <script src="./dist/bundle.js"></script>
  ```

+ ä½†æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬çš„æ–‡ä»¶åæˆ–è€…è·¯å¾„ä¼šå˜åŒ–ï¼Œä¾‹å¦‚ä½¿ç”¨ `[hash]` æ¥è¿›è¡Œå‘½åï¼Œé‚£ä¹ˆæœ€å¥½æ˜¯å°† `HTML` å¼•ç”¨è·¯å¾„å’Œæˆ‘ä»¬çš„æ„å»ºç»“æœå…³è”èµ·æ¥ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ `html-webpack-plugin`

+ `html-webpack-plugin` æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„ `node package`ï¼Œæ‰€ä»¥åœ¨ä½¿ç”¨ä¹‹å‰æˆ‘ä»¬éœ€è¦å…ˆå®‰è£…å®ƒï¼ŒæŠŠå®ƒå®‰è£…åˆ°é¡¹ç›®çš„å¼€å‘ä¾èµ–ä¸­

  ```
  npm install html-webpack-plugin -D
  ```

+ ç„¶ååœ¨ `webpack`é…ç½®ä¸­ï¼Œå°† `html-webpack-plugin` æ·»åŠ åˆ° `plugins` åˆ—è¡¨ä¸­

  ```js
  const HtmlWebpackPlugin = require('html-webpack-plugin')
  
  module.exports = {
    // ...
    plugins: [
      new HtmlWebpackPlugin(),
    ],
  }...
  ```

+ è¿™æ ·é…ç½®å¥½ä¹‹åï¼Œæ„å»ºæ—¶ `html-webpack-plugin` ä¼šä¸ºæˆ‘ä»¬åˆ›å»ºä¸€ä¸ª `HTML` æ–‡ä»¶ï¼Œå…¶ä¸­ä¼šå¼•ç”¨æ„å»ºå‡ºæ¥çš„ JS æ–‡ä»¶ã€‚å®é™…é¡¹ç›®ä¸­ï¼Œé»˜è®¤åˆ›å»ºçš„ `HTML` æ–‡ä»¶å¹¶æ²¡æœ‰ä»€ä¹ˆç”¨ï¼Œæˆ‘ä»¬éœ€è¦è‡ªå·±æ¥å†™ `HTML` æ–‡ä»¶ï¼Œå¯ä»¥é€šè¿‡ `html-webpack-plugin` çš„é…ç½®ï¼Œä¼ é€’ä¸€ä¸ªå†™å¥½çš„ HTML æ¨¡æ¿â€¦

  ```js
  module.exports = {
    // ...
    plugins: [
      new HtmlWebpackPlugin({
        filename: 'index.html', // é…ç½®è¾“å‡ºæ–‡ä»¶åå’Œè·¯å¾„
        template: 'assets/index.html', // é…ç½®æ–‡ä»¶æ¨¡æ¿ï¼Œä¹Ÿå°±æ˜¯å…¥å£
        inject: 'body',
      }),
    ],
  }...
  ```

+ è¿™æ ·ï¼Œé€šè¿‡ `html-webpack-plugin` å°±å¯ä»¥å°†æˆ‘ä»¬çš„é¡µé¢å’Œæ„å»º `JS` å…³è”èµ·æ¥ï¼Œå›å½’æ—¥å¸¸ï¼Œä»é¡µé¢å¼€å§‹å¼€å‘ã€‚å¦‚æœéœ€è¦æ·»åŠ å¤šä¸ªé¡µé¢å…³è”ï¼Œé‚£ä¹ˆå®ä¾‹åŒ–å¤šä¸ª `html-webpack-plugin`ï¼Œ å¹¶å°†å®ƒä»¬éƒ½æ”¾åˆ° `plugins` å­—æ®µæ•°ç»„ä¸­å°±å¯ä»¥äº†â€¦

### æ„å»º CSS

+ æˆ‘ä»¬ç¼–å†™ `CSS`ï¼Œå¹¶ä¸”å¸Œæœ›ä½¿ç”¨ `webpack` æ¥è¿›è¡Œæ„å»ºï¼Œä¸ºæ­¤ï¼Œéœ€è¦åœ¨é…ç½®ä¸­å¼•å…¥ `loader` æ¥è§£æå’Œå¤„ç† `CSS` æ–‡ä»¶

  ```js
  module.exports = {
    module: {
      rules: [
        // ...
        {
          test: /\.css/,
          include: [
            path.resolve(__dirname, 'src'),
          ],
          use: [
            'style-loader',
            'css-loader',
          ],
        },
      ],
    }
  }...
  ```

+ `css-loader` è´Ÿè´£è§£æ `CSS` ä»£ç ï¼Œä¸»è¦æ˜¯ä¸ºäº†å¤„ç† `CSS` ä¸­çš„ä¾èµ–ï¼Œä¾‹å¦‚ `@import` å’Œ `url()` ç­‰å¼•ç”¨å¤–éƒ¨æ–‡ä»¶çš„å£°æ˜ï¼›

+ `style-loader` ä¼šå°† `css-loader` è§£æçš„ç»“æœè½¬å˜æˆ `JS`ä»£ç ï¼Œè¿è¡Œæ—¶åŠ¨æ€æ’å…¥ `style` æ ‡ç­¾æ¥è®© `CSS` ä»£ç ç”Ÿæ•ˆâ€¦

+ ç»ç”±ä¸Šè¿°ä¸¤ä¸ª `loader` çš„å¤„ç†åï¼Œ**CSS ä»£ç ä¼šè½¬å˜ä¸º JS**ï¼Œå’Œ `index.js`ä¸€èµ·æ‰“åŒ…äº†ã€‚å¦‚æœéœ€è¦å•ç‹¬æŠŠ CSS æ–‡ä»¶åˆ†ç¦»å‡ºæ¥ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨ `extract-text-webpack-plugin` æ’ä»¶

  ```js
  const ExtractTextPlugin = require('extract-text-webpack-plugin')
  
  module.exports = {
    // ...
    module: {
      rules: [
        {
          test: /\.css$/,
          // å› ä¸ºè¿™ä¸ªæ’ä»¶éœ€è¦å¹²æ¶‰æ¨¡å—è½¬æ¢çš„å†…å®¹ï¼Œæ‰€ä»¥éœ€è¦ä½¿ç”¨å®ƒå¯¹åº”çš„ loader
          use: ExtractTextPlugin.extract({ 
            fallback: 'style-loader',
            use: 'css-loader',
          }), 
        },
      ],
    },
    plugins: [
      // å¼•å…¥æ’ä»¶ï¼Œé…ç½®æ–‡ä»¶åï¼Œè¿™é‡ŒåŒæ ·å¯ä»¥ä½¿ç”¨ [hash]
      new ExtractTextPlugin('index.css'),
    ],
  }...
  ```

### CSS é¢„å¤„ç†å™¨

+ åœ¨ä¸Šè¿°ä½¿ç”¨ CSS çš„åŸºç¡€ä¸Šï¼Œé€šå¸¸æˆ‘ä»¬ä¼šä½¿ç”¨ `Less/Sass` ç­‰ CSS é¢„å¤„ç†å™¨ï¼Œwebpack å¯ä»¥é€šè¿‡æ·»åŠ å¯¹åº”çš„ `loader` æ¥æ”¯æŒï¼Œä»¥ä½¿ç”¨ `Less` ä¸ºä¾‹ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å®˜æ–¹æ–‡æ¡£ä¸­æ‰¾åˆ°å¯¹åº”çš„ `loader`

  ```js
  module.exports = {
    // ...
    module: {
      rules: [
        {
          test: /\.less$/,
          // å› ä¸ºè¿™ä¸ªæ’ä»¶éœ€è¦å¹²æ¶‰æ¨¡å—è½¬æ¢çš„å†…å®¹ï¼Œæ‰€ä»¥éœ€è¦ä½¿ç”¨å®ƒå¯¹åº”çš„ loader
          use: ExtractTextPlugin.extract({ 
            fallback: 'style-loader',
            use: [
              'css-loader', 
              'less-loader',
            ],
          }), 
        },
      ],
    },
    // ...
  }...
  ```

### å¤„ç†å›¾ç‰‡æ–‡ä»¶

+ åœ¨å‰ç«¯é¡¹ç›®çš„æ ·å¼ä¸­æ€»ä¼šä½¿ç”¨åˆ°å›¾ç‰‡ï¼Œè™½ç„¶æˆ‘ä»¬å·²ç»æåˆ° `css-loader` ä¼šè§£ææ ·å¼ä¸­ç”¨ `url()` å¼•ç”¨çš„æ–‡ä»¶è·¯å¾„ï¼Œä½†æ˜¯å›¾ç‰‡å¯¹åº”çš„ `jpg/png/gif` ç­‰æ–‡ä»¶æ ¼å¼ï¼Œ`webpack` å¤„ç†ä¸äº†ã€‚æ˜¯çš„ï¼Œæˆ‘ä»¬åªè¦æ·»åŠ ä¸€ä¸ªå¤„ç†å›¾ç‰‡çš„ `loader` é…ç½®å°±å¯ä»¥äº†

#### file-loader

+ ç°æœ‰çš„ `file-loader` å°±æ˜¯ä¸ªä¸é”™çš„é€‰æ‹©â€¦

  ```js
  module.exports = {
    // ...
    module: {
      rules: [
        {
          test: /\.(png|jpg|gif)$/,
          use: [
            {
              loader: 'file-loader',
              options: {},
            },
          ],
        },
      ],
    },
  }...
  ```

+ åœ¨HTMLå’ŒCSSå†…ä½¿ç”¨æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥åƒå¹³å¸¸ä¸€æ ·ä½¿ç”¨ç›¸å¯¹è·¯å¾„å’Œç»å¯¹è·¯å¾„

  ```css
  // html
  <img src="./images/bg_img.png">
  
  // css
  { background: url("./images/bg_img.png"); }
  ```

+ åœ¨JSå†…ä½¿ç”¨çš„æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦é€šè¿‡å¼•å…¥å›¾ç‰‡ï¼Œä½œä¸ºæ¨¡å—ä½¿ç”¨

  ```jsx
  import imgURL from '../src/img/aboutme-background.jpg';
  <img src={imgURL } />  
  ```

  ```jsx
   <img src={require('../../../src/img/aboutme-background.jpg')} /> 
  ```

#### url-loader

+ url-loaderåŠŸèƒ½åŸºæœ¬å’Œfile-loaderä¸€è‡´ï¼Œæ‰€ä»¥ä¹Ÿå¯ç”¨url-loaderæ›¿ä»£ã€‚

+ url-loaderè¿˜å¯å¯¹å°äºæŸä¸ªå¤§å°å°ºå¯¸çš„å›¾ç‰‡è¿›è¡Œbase64æ ¼å¼çš„è½¬åŒ–å¤„ç†ã€‚

  ```js
  module.exports={
      module:{
          rules:[
              {
                  test: /\.(png|jpg|gif|svg)$/,
                  use: ['url-loader'],
                  options: {
                      name: './images/[name].[ext]',
                      limit: 1024
                  }        
              }
          ]
      }
  }
  ```

+ limitå±æ€§çš„ä½œç”¨å°±æ˜¯ï¼Œå°†æ–‡ä»¶å°äº1024Bå¤§å°çš„å›¾ç‰‡è½¬æˆbase64æ ¼å¼ï¼Œè€Œå¤§äºçš„åˆ™ä»¥file-loaderæ–¹å¼æ‰“åŒ…å¤„ç†ã€‚

#### å¯¹æ¯”

+ ä½¿ç”¨file-loaderæ–¹å¼æ‰“åŒ…ï¼š

  ![img](F:\OneDrive\JS\assets\168eb2112358cc34)

+ ä½¿ç”¨url-loaderæ–¹å¼æ‰“åŒ…ï¼š

  ![img](https://user-gold-cdn.xitu.io/2019/2/14/168eb2127cd9a434?imageView2/0/w/1280/h/960/format/webp/ignore-error/1)

+ å¦‚æœä¸å†™limitå±æ€§ï¼Œåˆ™ä¸ä¼šä»¥url-loaderæ–¹å¼æ‰“åŒ…

### ä½¿ç”¨ Babel

+ `Babel` æ˜¯ä¸€ä¸ªè®©æˆ‘ä»¬èƒ½å¤Ÿä½¿ç”¨ `ES` æ–°ç‰¹æ€§çš„ `JS` ç¼–è¯‘å·¥å…·ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ `webpack` ä¸­é…ç½® Babelï¼Œä»¥ä¾¿ä½¿ç”¨ `ES6`ã€`ES7` æ ‡å‡†æ¥ç¼–å†™ `JS`ä»£ç 

  ```js
  module.exports = {
    // ...
    module: {
      rules: [
        {
          test: /\.jsx?/, // æ”¯æŒ js å’Œ jsx
          include: [
            path.resolve(__dirname, 'src'), // src ç›®å½•ä¸‹çš„æ‰éœ€è¦ç»è¿‡ babel-loader å¤„ç†
          ],
          loader: 'babel-loader',
        },
      ],
    },
  }...
  ```

### å¯åŠ¨é™æ€æœåŠ¡

+ è‡³æ­¤ï¼Œæˆ‘ä»¬å®Œæˆäº†å¤„ç†å¤šç§æ–‡ä»¶ç±»å‹çš„ webpack é…ç½®ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ `webpack-dev-server` åœ¨æœ¬åœ°å¼€å¯ä¸€ä¸ªç®€å•çš„é™æ€æœåŠ¡æ¥è¿›è¡Œå¼€å‘

  ```
  npm i --save-dev webpack-dev-server
  ```

+ package.json

  ```js
  "scripts": {
    "build": "webpack --mode production",
    "start": "webpack-dev-server --mode development"
  }
  ```

+ å°è¯•ç€è¿è¡Œ `npm start` æˆ–è€… `yarn start`ï¼Œç„¶åå°±å¯ä»¥è®¿é—®`http://localhost:8080/` æ¥æŸ¥çœ‹ä½ çš„é¡µé¢äº†ã€‚é»˜è®¤æ˜¯è®¿é—® `index.html`ï¼Œå¦‚æœæ˜¯å…¶ä»–é¡µé¢è¦æ³¨æ„è®¿é—®çš„ URL æ˜¯å¦æ­£ç¡®

## webpackå¦‚ä½•è§£æä»£ç æ¨¡å—è·¯å¾„

+ webpack ä¸­æœ‰ä¸€ä¸ªå¾ˆå…³é”®çš„æ¨¡å— `enhanced-resolve` å°±æ˜¯å¤„ç†ä¾èµ–æ¨¡å—è·¯å¾„çš„è§£æçš„ï¼Œè¿™ä¸ªæ¨¡å—å¯ä»¥è¯´æ˜¯ Node.js é‚£ä¸€å¥—æ¨¡å—è·¯å¾„è§£æçš„å¢å¼ºç‰ˆæœ¬ï¼Œæœ‰å¾ˆå¤šå¯ä»¥è‡ªå®šä¹‰çš„è§£æé…ç½®

+ åœ¨ webpack é…ç½®ä¸­ï¼Œå’Œæ¨¡å—è·¯å¾„è§£æç›¸å…³çš„é…ç½®éƒ½åœ¨ `resolve`å­—æ®µä¸‹

  ```js
  module.exports = {
    resolve: {
      // ...
    }
  }
  ```

**ä¸€èˆ¬æ­¥éª¤**

+ è§£æè·¯å¾„åï¼Œè§£æå™¨å°†è·¯å¾„æŒ‡å‘æ–‡ä»¶æˆ–è€…æ–‡ä»¶å¤¹ï¼ˆç›®å½•ï¼‰
  + å¦‚æœæ˜¯æ–‡ä»¶ï¼Œç›´æ¥åŠ è½½ï¼Œæ ¹æ®resolve.extensionsé…ç½®è¡¥å……åç¼€å
  + å¦‚æœæ˜¯æ–‡ä»¶å¤¹ï¼ŒæŸ¥æ‰¾é‡Œé¢æ˜¯å¦æœ‰package.jsonæ–‡ä»¶
    + å¦‚æœæœ‰ï¼Œé»˜è®¤æŒ‰ç…§é‡Œé¢çš„mainå­—æ®µçš„æ–‡ä»¶åæŸ¥æ‰¾æ–‡ä»¶ ï¼ˆå¯ä»¥é€šè¿‡`resolve.mainFields` é…ç½®æ›´æ”¹ï¼‰
    + å¦‚æœæ²¡æœ‰ï¼Œé»˜è®¤æŸ¥æ‰¾index.jsæ–‡ä»¶ï¼ˆå¯ä»¥é€šè¿‡`resolve.mainFiles`é…ç½®æ›´æ”¹ï¼‰

### resolve.alias

+ aliasï¼Œé¡¾åæ€ä¹‰ï¼Œæ˜¯æŒ‡è·¯å¾„çš„åˆ«åã€‚ç®€å•ç‚¹è¯´ï¼Œå°±æ˜¯ç”¨ä¸€ä¸ªç®€å•çš„åˆ«åæ¥æ›¿æ¢ä¸€ä¸ªå¸¸ç”¨çš„æˆ–è€…å¤æ‚çš„æ–‡ä»¶è·¯å¾„ã€‚

+ åŸç†ï¼šå…ˆæ›¿æ¢ï¼Œåè§£æã€‚åœ¨å¼•å…¥æ¨¡å—æ—¶ï¼Œå…ˆå°†æ¨¡å—è·¯å¾„ä¸­åŒ¹é…aliasä¸­çš„keyæ›¿æ¢æˆå¯¹åº”çš„valueï¼Œå†åšæŸ¥æ‰¾

  > 1. æ›¿æ¢æ‰çš„è·¯å¾„å¯ä»¥æ˜¯ç›¸å¯¹è·¯å¾„ï¼Œä¹Ÿå¯ä»¥æ˜¯ç»å¯¹è·¯å¾„ã€‚
  
+ å‡è®¾æˆ‘ä»¬æœ‰ä¸ª `utils` æ¨¡å—æå…¶å¸¸ç”¨ï¼Œç»å¸¸ç¼–å†™ç›¸å¯¹è·¯å¾„å¾ˆéº»çƒ¦ï¼Œå¸Œæœ›å¯ä»¥ç›´æ¥ `import 'utils'` æ¥å¼•ç”¨ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥é…ç½®æŸä¸ªæ¨¡å—çš„åˆ«åï¼Œå¦‚

  ```js
  alias: {
    utils: path.resolve(__dirname, 'src/utils') // è¿™é‡Œä½¿ç”¨ path.resolve å’Œ __dirname æ¥è·å–ç»å¯¹è·¯å¾„
  }
  ```

+ ä¸Šè¿°çš„é…ç½®æ˜¯æ¨¡ç³ŠåŒ¹é…ï¼Œæ„å‘³ç€åªè¦æ¨¡å—è·¯å¾„ä¸­æºå¸¦äº† utils å°±å¯ä»¥è¢«æ›¿æ¢æ‰ï¼Œå¦‚ï¼š

  ```js
  import 'utils/query.js' // ç­‰åŒäº import '[é¡¹ç›®ç»å¯¹è·¯å¾„]/src/utils/query.js'
  ```

+ å¦‚æœéœ€è¦è¿›è¡Œç²¾ç¡®åŒ¹é…å¯ä»¥ä½¿ç”¨`$`ï¼š

  ```js
  alias: {
    utils$: path.resolve(__dirname, 'src/utils') // åªä¼šåŒ¹é… import 'utils'
  }
  ```

### resolve.extensions

+ ```js
  extensions: ['.wasm', '.mjs', '.js', '.json', '.jsx'],
  // è¿™é‡Œçš„é¡ºåºä»£è¡¨åŒ¹é…åç¼€çš„ä¼˜å…ˆçº§ï¼Œä¾‹å¦‚å¯¹äº index.js å’Œ index.jsxï¼Œä¼šä¼˜å…ˆé€‰æ‹© index.js
  ```

+ è¿™ä¸ªé…ç½®çš„ä½œç”¨æ˜¯å’Œæ–‡ä»¶åç¼€åæœ‰å…³çš„,è¿™ä¸ªé…ç½®å¯ä»¥å®šä¹‰åœ¨è¿›è¡Œæ¨¡å—è·¯å¾„è§£ææ—¶ï¼Œwebpack ä¼šå°è¯•å¸®ä½ è¡¥å…¨é‚£äº›åç¼€åæ¥è¿›è¡ŒæŸ¥æ‰¾

### resolve.modules

+ æŸ¥æ‰¾å£°æ˜ä¾èµ–åçš„æ¨¡å—ï¼Œé»˜è®¤æœç´¢node_modulesç›®å½•ã€‚ä¸€èˆ¬æˆ‘ä»¬ä¸ä¿®æ”¹è¿™ä¸ªé…ç½®ã€‚

  ```js
  resolve: {
    modules: ['node_modules']
  },
  ```

### resolve.mainFields

+ åœ¨å¼•ç”¨æ¨¡å—æ—¶ï¼ŒæŒ‡æ˜ä½¿ç”¨package.jsonä¸­å“ªä¸ªå­—æ®µæŒ‡å®šçš„æ–‡ä»¶ï¼Œé»˜è®¤æ˜¯â€œmainâ€

  ```js
  resolve: {
    // é…ç½® target === "web" æˆ–è€… target === "webworker" æ—¶ mainFields é»˜è®¤å€¼æ˜¯ï¼š
    mainFields: ['browser', 'module', 'main'],
  
    // target çš„å€¼ä¸ºå…¶ä»–æ—¶ï¼ŒmainFields é»˜è®¤å€¼ä¸ºï¼š
    mainFields: ["module", "main"],
  }
  ```

+ å› ä¸ºé€šå¸¸æƒ…å†µä¸‹ï¼Œæ¨¡å—çš„ package éƒ½ä¸ä¼šå£°æ˜ browser æˆ– module å­—æ®µï¼Œæ‰€ä»¥ä¾¿æ˜¯ä½¿ç”¨ main äº†ã€‚

### resolve.mainFiles

+ åœ¨ç›®å½•ä¸­æ²¡æœ‰package.jsonæ—¶ï¼ŒæŒ‡æ˜ä½¿ç”¨è¯¥ç›®å½•ä¸­å“ªä¸ªæ–‡ä»¶ï¼Œé»˜è®¤æ˜¯index.js

  ```js
  resolve: {
    mainFiles: ['index'], // å¯ä»¥æ·»åŠ å…¶ä»–é»˜è®¤ä½¿ç”¨çš„æ–‡ä»¶å
  }
  ```

+ ./design/Cascader/ è§£æä¸ºæ–‡ä»¶å¤¹ï¼Œæœ‰æ²¡æœ‰åŠæ³•ä¸åŠ æœ€åä¸€ä¸ªæ–œæ å‘¢ï¼Ÿ
+ ./design/Cascader è§£æä¸ºæ–‡ä»¶

## é…ç½®loader

### loader åŒ¹é…è§„åˆ™

+ å½“æˆ‘ä»¬éœ€è¦é…ç½® `loader` æ—¶ï¼Œéƒ½æ˜¯åœ¨ `module.rules` ä¸­æ·»åŠ æ–°çš„é…ç½®é¡¹ï¼Œåœ¨è¯¥å­—æ®µä¸­ï¼Œæ¯ä¸€é¡¹è¢«è§†ä¸ºä¸€æ¡åŒ¹é…ä½¿ç”¨ `loader`çš„è§„åˆ™

  ```js
  module.exports = {
    // ...
    module: {
      rules: [ 
        {
          test: /\.jsx?/, // æ¡ä»¶
          include: [ 
            path.resolve(__dirname, 'src'),
          ], // æ¡ä»¶
          use: 'babel-loader', // è§„åˆ™åº”ç”¨ç»“æœ
        }, // ä¸€ä¸ª object å³ä¸€æ¡è§„åˆ™
        // ...
      ],
    },
  }...
  ```

+ `loader` çš„åŒ¹é…è§„åˆ™ä¸­æœ‰ä¸¤ä¸ªæœ€å…³é”®çš„å› ç´ ï¼šä¸€ä¸ªæ˜¯åŒ¹é…æ¡ä»¶ï¼Œä¸€ä¸ªæ˜¯åŒ¹é…è§„åˆ™åçš„åº”ç”¨

### è§„åˆ™æ¡ä»¶é…ç½®

+ å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œé…ç½® `loader` çš„åŒ¹é…æ¡ä»¶æ—¶ï¼Œåªè¦ä½¿ç”¨ `test` å­—æ®µå°±å¥½äº†ï¼Œå¾ˆå¤šæ—¶å€™éƒ½åªéœ€è¦åŒ¹é…æ–‡ä»¶åç¼€åæ¥å†³å®šä½¿ç”¨ä»€ä¹ˆ `loader`ï¼Œä½†ä¹Ÿä¸æ’é™¤åœ¨æŸäº›ç‰¹æ®Šåœºæ™¯ä¸‹ï¼Œæˆ‘ä»¬éœ€è¦é…ç½®æ¯”è¾ƒå¤æ‚çš„åŒ¹é…æ¡ä»¶ã€‚webpack çš„è§„åˆ™æä¾›äº†å¤šç§é…ç½®å½¢å¼â€¦

  ```js
  { test: ... } åŒ¹é…ç‰¹å®šæ¡ä»¶
  { include: ... } åŒ¹é…ç‰¹å®šè·¯å¾„
  { exclude: ... }æ’é™¤ç‰¹å®šè·¯å¾„
  { and: [...] }å¿…é¡»åŒ¹é…æ•°ç»„ä¸­æ‰€æœ‰æ¡ä»¶
  { or: [...] }åŒ¹é…æ•°ç»„ä¸­ä»»æ„ä¸€ä¸ªæ¡ä»¶
  { not: [...] } æ’é™¤åŒ¹é…æ•°ç»„ä¸­æ‰€æœ‰æ¡ä»¶â€¦
  ```

+ ä¸Šè¿°çš„æ‰€è°“æ¡ä»¶çš„å€¼å¯ä»¥æ˜¯ï¼š

  + å­—ç¬¦ä¸²ï¼šå¿…é¡»ä»¥æä¾›çš„å­—ç¬¦ä¸²å¼€å§‹ï¼Œæ‰€ä»¥æ˜¯å­—ç¬¦ä¸²çš„è¯ï¼Œè¿™é‡Œæˆ‘ä»¬éœ€è¦æä¾›**ç»å¯¹è·¯å¾„**
  + æ­£åˆ™è¡¨è¾¾å¼ï¼šè°ƒç”¨æ­£åˆ™çš„ `test` æ–¹æ³•æ¥åˆ¤æ–­åŒ¹é…
  + å‡½æ•°ï¼š`(path) => boolean`ï¼Œè¿”å› `true` è¡¨ç¤ºåŒ¹é…
  + æ•°ç»„ï¼šè‡³å°‘åŒ…å«ä¸€ä¸ªæ¡ä»¶çš„æ•°ç»„
  + å¯¹è±¡ï¼šåŒ¹é…æ‰€æœ‰å±æ€§å€¼çš„æ¡ä»¶â€¦

  ```js
  rules: [
    {
      test: /\.jsx?/, // æ­£åˆ™
      include: [
        path.resolve(__dirname, 'src'), // å­—ç¬¦ä¸²ï¼Œæ³¨æ„æ˜¯ç»å¯¹è·¯å¾„
      ], // æ•°ç»„
      // ...
    },
    {
      test: {
        js: /\.js/,
        jsx: /\.jsx/,
      }, // å¯¹è±¡ï¼Œä¸å»ºè®®ä½¿ç”¨
      not: [
        (value) => { /* ... */ return true; }, // å‡½æ•°ï¼Œé€šå¸¸éœ€è¦é«˜åº¦è‡ªå®šä¹‰æ—¶æ‰ä¼šä½¿ç”¨
      ],
    },
  ],...
  ```

### ä½¿ç”¨ loader é…ç½®

+ `module.rules` çš„åŒ¹é…è§„åˆ™æœ€é‡è¦çš„è¿˜æ˜¯ç”¨äºé…ç½® `loader`ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ `use` å­—æ®µ

  ```js
  rules: [
    {
      test: /\.less/,
      use: [
        'style-loader', // ç›´æ¥ä½¿ç”¨å­—ç¬¦ä¸²è¡¨ç¤º loader
        {
          loader: 'css-loader',
          options: {
            importLoaders: 1
          },
        }, // ç”¨å¯¹è±¡è¡¨ç¤º loaderï¼Œå¯ä»¥ä¼ é€’ loader é…ç½®ç­‰
        {
          loader: 'less-loader',
          options: {
            noIeCompat: true
          }, // ä¼ é€’ loader é…ç½®
        },
      ],
    },
  ],...
  ```

+ `use`å­—æ®µå¯ä»¥æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²æˆ–è€…è¡¨ç¤º `loader` çš„å¯¹è±¡ã€‚å¦‚æœåªéœ€è¦ä¸€ä¸ª `loader`ï¼Œä¹Ÿå¯ä»¥è¿™æ ·ï¼š`use: { loader: 'babel-loader'`, `options: { ... } }`

###  loader åº”ç”¨é¡ºåº

+ å¯¹äºä¸Šé¢çš„ `less` è§„åˆ™é…ç½®ï¼Œä¸€ä¸ª `style.less` æ–‡ä»¶ä¼šé€”å¾„ `less-loader`ã€`css-loader`ã€`style-loader` å¤„ç†ï¼Œæˆä¸ºä¸€ä¸ªå¯ä»¥æ‰“åŒ…çš„æ¨¡å—ã€‚

+ `loader` çš„åº”ç”¨é¡ºåºåœ¨é…ç½®å¤šä¸ª `loader` ä¸€èµ·å·¥ä½œæ—¶å¾ˆé‡è¦ï¼Œé€šå¸¸ä¼šä½¿ç”¨åœ¨ CSS é…ç½®ä¸Šï¼Œé™¤äº† `style-loader` å’Œ `css-loader`ï¼Œä½ å¯èƒ½è¿˜è¦é…ç½® `less-loader`ç„¶åå†åŠ ä¸ª `postcss` çš„ `autoprefixer` ç­‰ã€‚

+ ä¸Šè¿°ä»ååˆ°å‰çš„é¡ºåºæ˜¯åœ¨åŒä¸€ä¸ª `rule` ä¸­è¿›è¡Œçš„ï¼Œé‚£å¦‚æœå¤šä¸ª `rule` åŒ¹é…äº†åŒä¸€ä¸ªæ¨¡å—æ–‡ä»¶ï¼Œ`loader` çš„åº”ç”¨é¡ºåºåˆæ˜¯æ€æ ·çš„å‘¢ï¼Ÿçœ‹ä¸€ä»½è¿™æ ·çš„é…ç½®â€¦

  ```js
  rules: [
    {
      test: /\.js$/,
      exclude: /node_modules/,
      loader: "eslint-loader",
    },
    {
      test: /\.js$/,
      exclude: /node_modules/,
      loader: "babel-loader",
    },
  ],...
  ```

+ è¿™æ ·æ— æ³•æ³•ä¿è¯ `eslint-loader` åœ¨ `babel-loader` åº”ç”¨å‰æ‰§è¡Œã€‚`webpack`åœ¨ r`ules` ä¸­æä¾›äº†ä¸€ä¸ª `enforce` çš„å­—æ®µæ¥é…ç½®å½“å‰ `rule` çš„ `loader` ç±»å‹ï¼Œæ²¡é…ç½®çš„è¯æ˜¯æ™®é€šç±»å‹ï¼Œæˆ‘ä»¬å¯ä»¥é…ç½® `pre`æˆ–`post`ï¼Œåˆ†åˆ«å¯¹åº”å‰ç½®ç±»å‹æˆ–åç½®ç±»å‹çš„ `loader`â€¦

+ æ‰€æœ‰çš„ `loader` **æŒ‰ç…§å‰ç½®** -> **è¡Œ**å†… -> **æ™®é€š** -> **åç½®**çš„é¡ºåºæ‰§è¡Œã€‚æ‰€ä»¥å½“æˆ‘ä»¬è¦ç¡®ä¿ `eslint-loader` åœ¨ `babel-loader` ä¹‹å‰æ‰§è¡Œæ—¶ï¼Œå¯ä»¥å¦‚ä¸‹æ·»åŠ  `enforce` é…ç½®

  ```js
  rules: [
    {
      enforce: 'pre', // æŒ‡å®šä¸ºå‰ç½®ç±»å‹
      test: /\.js$/,
      exclude: /node_modules/,
      loader: "eslint-loader",
    },
  ]...
  ```

+ å½“é¡¹ç›®æ–‡ä»¶ç±»å‹å’Œåº”ç”¨çš„ `loader` ä¸æ˜¯ç‰¹åˆ«å¤æ‚çš„æ—¶å€™ï¼Œé€šå¸¸å»ºè®®æŠŠè¦åº”ç”¨çš„åŒä¸€ç±»å‹ `loader` éƒ½å†™åœ¨åŒä¸€ä¸ªåŒ¹é…è§„åˆ™ä¸­ï¼Œè¿™æ ·æ›´å¥½ç»´æŠ¤å’Œæ§åˆ¶

## ä½¿ç”¨plugin

+ æ›´å¤šçš„æ’ä»¶å¯ä»¥åœ¨è¿™é‡ŒæŸ¥æ‰¾ï¼š[plugins in awesome-webpack](https://github.com/webpack-contrib/awesome-webpack#webpack-plugins)

### DefinePlugin

+ `DefinePlugin` æ˜¯ `webpack` å†…ç½®çš„æ’ä»¶ï¼Œå¯ä»¥ä½¿ç”¨ `webpack.DefinePlugin` ç›´æ¥è·å–

+ è¿™ä¸ªæ’ä»¶ç”¨äºåˆ›å»ºä¸€äº›åœ¨ç¼–è¯‘æ—¶å¯ä»¥é…ç½®çš„å…¨å±€å¸¸é‡ï¼Œè¿™äº›å¸¸é‡çš„å€¼æˆ‘ä»¬å¯ä»¥åœ¨ `webpack` çš„é…ç½®ä¸­å»æŒ‡å®šï¼Œä¾‹å¦‚

  ```js
  module.exports = {
    // ...
    plugins: [
      new webpack.DefinePlugin({
        PRODUCTION: JSON.stringify(true), // const PRODUCTION = true
        VERSION: JSON.stringify('5fa3b9'), // const VERSION = '5fa3b9'
        BROWSER_SUPPORTS_HTML5: true, // const BROWSER_SUPPORTS_HTML5 = 'true'
        TWO: '1+1', // const TWO = 1 + 1,
        CONSTANTS: {
          APP_VERSION: JSON.stringify('1.1.2') // const CONSTANTS = { APP_VERSION: '1.1.2' }
        }
      }),
    ],
  }...
  ```

+ æœ‰äº†ä¸Šé¢çš„é…ç½®ï¼Œå°±å¯ä»¥åœ¨åº”ç”¨ä»£ç æ–‡ä»¶ä¸­ï¼Œè®¿é—®é…ç½®å¥½çš„å˜é‡äº†ï¼Œå¦‚ï¼š

  ```js
  console.log("Running App version " + VERSION);
  
  if(!BROWSER_SUPPORTS_HTML5) require("html5shiv");
  ```

+ ä¸Šé¢é…ç½®çš„æ³¨é‡Šå·²ç»ç®€å•è¯´æ˜äº†è¿™äº›é…ç½®çš„æ•ˆæœï¼Œè¿™é‡Œå†ç®€è¿°ä¸€ä¸‹æ•´ä¸ªé…ç½®è§„åˆ™ï¼š

  + å¦‚æœé…ç½®çš„å€¼æ˜¯å­—ç¬¦ä¸²ï¼Œé‚£ä¹ˆæ•´ä¸ªå­—ç¬¦ä¸²ä¼šè¢«å½“æˆä»£ç ç‰‡æ®µæ¥æ‰§è¡Œï¼Œå…¶ç»“æœä½œä¸ºæœ€ç»ˆå˜é‡çš„å€¼ï¼Œå¦‚ä¸Šé¢çš„ `"1+1"`ï¼Œæœ€åçš„ç»“æœæ˜¯ `2`
  + å¦‚æœé…ç½®çš„å€¼ä¸æ˜¯å­—ç¬¦ä¸²ï¼Œä¹Ÿä¸æ˜¯ä¸€ä¸ªå¯¹è±¡å­—é¢é‡ï¼Œé‚£ä¹ˆè¯¥å€¼ä¼šè¢«è½¬ä¸ºä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå¦‚ `true`ï¼Œæœ€åçš„ç»“æœæ˜¯ `'true'`
  + å¦‚æœé…ç½®çš„æ˜¯ä¸€ä¸ªå¯¹è±¡å­—é¢é‡ï¼Œé‚£ä¹ˆè¯¥å¯¹è±¡çš„æ‰€æœ‰ `key`ä¼šä»¥åŒæ ·çš„æ–¹å¼å»å®šä¹‰
  + è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥ç†è§£ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ `JSON.stringify()` äº†ï¼Œå› ä¸º `JSON.stringify(true)` çš„ç»“æœæ˜¯ `'true'`ï¼Œ`JSON.stringify("5fa3b9")` çš„ç»“æœæ˜¯ `"5fa3b9"`ã€‚

+ ç¤¾åŒºä¸­å…³äº `DefinePlugin` ä½¿ç”¨å¾—æœ€å¤šçš„æ–¹å¼æ˜¯å®šä¹‰ç¯å¢ƒå˜é‡ï¼Œä¾‹å¦‚ `PRODUCTION = true` æˆ–è€… `__DEV__ = true`ç­‰ã€‚éƒ¨åˆ†ç±»åº“åœ¨å¼€å‘ç¯å¢ƒæ—¶ä¾èµ–è¿™æ ·çš„ç¯å¢ƒå˜é‡æ¥ç»™äºˆå¼€å‘è€…æ›´å¤šçš„å¼€å‘è°ƒè¯•åé¦ˆï¼Œä¾‹å¦‚ react ç­‰ã€‚

+ å»ºè®®ä½¿ç”¨ `process.env.NODE_ENV`: â€¦ çš„æ–¹å¼æ¥å®šä¹‰ `process.env.NODE_ENV`ï¼Œè€Œä¸æ˜¯ä½¿ç”¨ `process: { env: { NODE_ENV: ... } }` çš„æ–¹å¼ï¼Œå› ä¸ºè¿™æ ·ä¼šè¦†ç›–æ‰ `process` è¿™ä¸ªå¯¹è±¡ï¼Œå¯èƒ½ä¼šå¯¹å…¶ä»–ä»£ç é€ æˆå½±å“â€¦

### copy-webpack-plugin

+ æˆ‘ä»¬ä¸€èˆ¬ä¼šæŠŠå¼€å‘çš„æ‰€æœ‰æºç å’Œèµ„æºæ–‡ä»¶æ”¾åœ¨ `src/` ç›®å½•ä¸‹ï¼Œæ„å»ºçš„æ—¶å€™äº§å‡ºä¸€ä¸ª `build/` ç›®å½•ï¼Œé€šå¸¸ä¼šç›´æ¥æ‹¿ `build` ä¸­çš„æ‰€æœ‰æ–‡ä»¶æ¥å‘å¸ƒã€‚æœ‰äº›æ–‡ä»¶æ²¡ç»è¿‡ `webpack` å¤„ç†ï¼Œä½†æ˜¯æˆ‘ä»¬å¸Œæœ›å®ƒä»¬ä¹Ÿèƒ½å‡ºç°åœ¨ `build`ç›®å½•ä¸‹ï¼Œè¿™æ—¶å°±å¯ä»¥ä½¿ç”¨ `CopyWebpackPlugin` æ¥å¤„ç†äº†â€¦

  ```js
  const CopyWebpackPlugin = require('copy-webpack-plugin')
  
  module.exports = {
    // ...
    plugins: [
      new CopyWebpackPlugin([
        { from: 'src/file.txt', to: 'build/file.txt', }, // é¡¾åæ€ä¹‰ï¼Œfrom é…ç½®æ¥æºï¼Œto é…ç½®ç›®æ ‡è·¯å¾„
        { from: 'src/*.ico', to: 'build/*.ico' }, // é…ç½®é¡¹å¯ä»¥ä½¿ç”¨ glob
        // å¯ä»¥é…ç½®å¾ˆå¤šé¡¹å¤åˆ¶è§„åˆ™
      ]),
    ],
  }...
  ```

- https://juejin.im/post/59a3ec53f265da2490350edb

### extract-text-webpack-plugin

+ æˆ‘ä»¬ç”¨å®ƒæ¥æŠŠä¾èµ–çš„ `CSS` åˆ†ç¦»å‡ºæ¥æˆä¸ºå•ç‹¬çš„æ–‡ä»¶ã€‚è¿™é‡Œå†çœ‹ä¸€ä¸‹ä½¿ç”¨ `extract-text-webpack-plugin` çš„é…ç½®

  ```js
  const ExtractTextPlugin = require('extract-text-webpack-plugin')
  
  module.exports = {
    // ...
    module: {
      rules: [
        {
          test: /\.css$/,
          // å› ä¸ºè¿™ä¸ªæ’ä»¶éœ€è¦å¹²æ¶‰æ¨¡å—è½¬æ¢çš„å†…å®¹ï¼Œæ‰€ä»¥éœ€è¦ä½¿ç”¨å®ƒå¯¹åº”çš„ loader
          use: ExtractTextPlugin.extract({ 
            fallback: 'style-loader',
            use: 'css-loader',
          }), 
        },
      ],
    },
    plugins: [
      // å¼•å…¥æ’ä»¶ï¼Œé…ç½®æ–‡ä»¶åï¼Œè¿™é‡ŒåŒæ ·å¯ä»¥ä½¿ç”¨ [hash]
      new ExtractTextPlugin('index.css'),
    ],
  }...
  ```

+ åœ¨ä¸Šè¿°çš„é…ç½®ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº† `index.css` ä½œä¸ºå•ç‹¬åˆ†ç¦»å‡ºæ¥çš„æ–‡ä»¶åï¼Œä½†æœ‰çš„æ—¶å€™æ„å»ºå…¥å£ä¸æ­¢ä¸€ä¸ªï¼Œ`extract-text-webpack-plugin` ä¼šä¸ºæ¯ä¸€ä¸ªå…¥å£åˆ›å»ºå•ç‹¬åˆ†ç¦»çš„æ–‡ä»¶ï¼Œå› æ­¤æœ€å¥½è¿™æ ·é…ç½®

  ```js
  // è¿™æ ·ç¡®ä¿åœ¨ä½¿ç”¨å¤šä¸ªæ„å»ºå…¥å£æ—¶ï¼Œç”Ÿæˆä¸åŒåç§°çš„æ–‡ä»¶
  plugins: [
    new ExtractTextPlugin('[name].css'),
  ],
  ```

## æ›´å¥½åœ°ä½¿ç”¨webpack-dev-server

+ `webpack-dev-server` æ˜¯ `webpack` å®˜æ–¹æä¾›çš„ä¸€ä¸ªå·¥å…·ï¼Œå¯ä»¥åŸºäºå½“å‰çš„ `webpack` æ„å»ºé…ç½®å¿«é€Ÿå¯åŠ¨ä¸€ä¸ªé™æ€æœåŠ¡ã€‚å½“ `mode` ä¸º `development` æ—¶ï¼Œä¼šå…·å¤‡ `hot reload` çš„åŠŸèƒ½ï¼Œå³å½“æºç æ–‡ä»¶å˜åŒ–æ—¶ï¼Œä¼šå³æ—¶æ›´æ–°å½“å‰é¡µé¢ï¼Œä»¥ä¾¿ä½ çœ‹åˆ°æœ€æ–°çš„æ•ˆæœâ€¦

### åŸºç¡€ä½¿ç”¨

+ `webpack-dev-server` æ˜¯ä¸€ä¸ª `npm package`ï¼Œå®‰è£…ååœ¨å·²ç»æœ‰ `webpack` é…ç½®æ–‡ä»¶çš„é¡¹ç›®ç›®å½•ä¸‹ç›´æ¥å¯åŠ¨å°±å¯ä»¥

  ```
  npm install webpack-dev-server -g
  webpack-dev-server --mode development
  ```

+ `webpack-dev-server` é»˜è®¤ä½¿ç”¨ `8080` ç«¯å£

+ package.json

  ```js
  {
    // ...
    "scripts": {
      "start": "webpack-dev-server --mode development"
    }
  }
  ```

### é…ç½®

+ åœ¨ webpack çš„é…ç½®ä¸­ï¼Œå¯ä»¥é€šè¿‡ `devServer` å­—æ®µæ¥é…ç½® `webpack-dev-server`ï¼Œå¦‚ç«¯å£è®¾ç½®ã€å¯åŠ¨ `gzip` å‹ç¼©ç­‰ï¼Œè¿™é‡Œç®€å•è®²è§£å‡ ä¸ªå¸¸ç”¨çš„é…ç½®

+ `public`å­—æ®µç”¨äºæŒ‡å®šé™æ€æœåŠ¡çš„åŸŸåï¼Œé»˜è®¤æ˜¯ `http://localhost:8080/` ï¼Œå½“ä½ ä½¿ç”¨ `Nginx` æ¥åšåå‘ä»£ç†æ—¶ï¼Œåº”è¯¥å°±éœ€è¦ä½¿ç”¨è¯¥é…ç½®æ¥æŒ‡å®š `Nginx` é…ç½®ä½¿ç”¨çš„æœåŠ¡åŸŸå

+ `port` å­—æ®µç”¨äºæŒ‡å®šé™æ€æœåŠ¡çš„ç«¯å£ï¼Œå¦‚ä¸Šï¼Œé»˜è®¤æ˜¯ `8080`ï¼Œé€šå¸¸æƒ…å†µä¸‹éƒ½ä¸éœ€è¦æ”¹åŠ¨

+ `publicPath` å­—æ®µç”¨äºæŒ‡å®šæ„å»ºå¥½çš„é™æ€æ–‡ä»¶åœ¨æµè§ˆå™¨ä¸­ç”¨ä»€ä¹ˆè·¯å¾„å»è®¿é—®ï¼Œé»˜è®¤æ˜¯ `/`

  + ä¾‹å¦‚ï¼Œå¯¹äºä¸€ä¸ªæ„å»ºå¥½çš„æ–‡ä»¶ `bundle.js`ï¼Œå®Œæ•´çš„è®¿é—®è·¯å¾„æ˜¯ `http://localhost:8080/bundle.js`ï¼Œ
  + å¦‚æœä½ é…ç½®äº† `publicPath: 'assets/'`ï¼Œé‚£ä¹ˆä¸Šè¿° `bundle.js` çš„å®Œæ•´è®¿é—®è·¯å¾„å°±æ˜¯ `http://localhost:8080/assets/bundle.js`ã€‚
  + å¯ä»¥ä½¿ç”¨æ•´ä¸ª `URL` æ¥ä½œä¸º `publicPath`çš„å€¼ï¼Œå¦‚ `publicPath: 'http://localhost:8080/assets/'`ã€‚
  + å¦‚æœä½ ä½¿ç”¨äº† `HMR`ï¼Œé‚£ä¹ˆè¦è®¾ç½® `publicPath` å°±å¿…é¡»ä½¿ç”¨å®Œæ•´çš„ `URL`
  + å»ºè®®å°† `devServer.publicPath` å’Œ `output.publicPath` çš„å€¼ä¿æŒä¸€è‡´

+ `before` å’Œ `after` é…ç½®ç”¨äºåœ¨ `webpack-dev-server` å®šä¹‰é¢å¤–çš„ä¸­é—´ä»¶ï¼Œå¦‚

  ```js
  before(app){
    app.get('/some/path', function(req, res) { // å½“è®¿é—® /some/path è·¯å¾„æ—¶ï¼Œè¿”å›è‡ªå®šä¹‰çš„ json æ•°æ®
      res.json({ custom: 'response' })
    })
  }...
  
  ```

+ `before` åœ¨ `webpack-dev-server` é™æ€èµ„æºä¸­é—´ä»¶å¤„ç†ä¹‹å‰ï¼Œå¯ä»¥ç”¨äºæ‹¦æˆªéƒ¨åˆ†è¯·æ±‚è¿”å›ç‰¹å®šå†…å®¹ï¼Œæˆ–è€…å®ç°ç®€å•çš„æ•°æ® `mock`ã€‚

+ `after` åœ¨ `webpack-dev-server` é™æ€èµ„æºä¸­é—´ä»¶å¤„ç†ä¹‹åï¼Œæ¯”è¾ƒå°‘ç”¨åˆ°ï¼Œå¯ä»¥ç”¨äºæ‰“å°æ—¥å¿—æˆ–è€…åšä¸€äº›é¢å¤–å¤„ç†â€¦

#### proxyå­—æ®µ

- `proxy`ç”¨äºé…ç½® `webpack-dev-server`å°†ç‰¹å®š `URL` çš„è¯·æ±‚ä»£ç†åˆ°å¦å¤–ä¸€å°æœåŠ¡å™¨ä¸Šã€‚å½“ä½ æœ‰å•ç‹¬çš„åç«¯å¼€å‘æœåŠ¡å™¨ç”¨äºè¯·æ±‚ API æ—¶ï¼Œè¿™ä¸ªé…ç½®ç›¸å½“æœ‰ç”¨

- dev-server ä½¿ç”¨äº†éå¸¸å¼ºå¤§çš„ [http-proxy-middleware](https://github.com/chimurai/http-proxy-middleware) åŒ…ã€‚æ›´å¤šé«˜çº§ç”¨æ³•ï¼Œè¯·æŸ¥é˜…å…¶ [æ–‡æ¡£](https://github.com/chimurai/http-proxy-middleware#options)ã€‚

**åŸºæœ¬ä½¿ç”¨**

- åœ¨ `localhost:3000` ä¸Šæœ‰åç«¯æœåŠ¡çš„è¯ï¼Œä½ å¯ä»¥è¿™æ ·å¯ç”¨ä»£ç†ï¼š

- **webpack.config.js**

  ```javascript
  module.exports = {
    //...
    devServer: {
      proxy: {
        '/api': 'http://localhost:3000'
      }
    }
  };
  ```

- è¯·æ±‚åˆ° `/api/users` ç°åœ¨ä¼šè¢«ä»£ç†åˆ°è¯·æ±‚ `http://localhost:3000/api/users`ã€‚

**é‡å†™è·¯å¾„**

- å¦‚æœä½ ä¸æƒ³å§‹ç»ˆä¼ é€’ `/api` ï¼Œåˆ™éœ€è¦é‡å†™è·¯å¾„ï¼š

- **webpack.config.js**

  ```javascript
  module.exports = {
    //...
    devServer: {
      proxy: {
        '/api': {
          target: 'http://localhost:3000',
          pathRewrite: {'^/api' : ''}
        }
      }
    }
  };
  ```

- åç«¯ä¸éœ€è¦å†åŠ ä¸Š â€˜apiâ€™ ï¼Œä½†æ˜¯å‰ç«¯è¯·æ±‚è¿˜æ˜¯è¦çš„ï¼Œç”¨ä½œ**è½¬å‘çš„**æ ‡å¿—

**ä»£ç†å¤šä¸ªè·¯å¾„**

- å¦‚æœä½ æƒ³è¦ä»£ç†å¤šä¸ªè·¯å¾„ç‰¹å®šåˆ°åŒä¸€ä¸ª target ä¸‹ï¼Œä½ å¯ä»¥ä½¿ç”¨ç”±ä¸€ä¸ªæˆ–å¤šä¸ªã€Œå…·æœ‰ `context` å±æ€§çš„å¯¹è±¡ã€æ„æˆçš„æ•°ç»„ï¼š

  **webpack.config.js**

  ```javascript
  module.exports = {
    //...
    devServer: {
      proxy: [{
        context: ['/auth', '/api'],
        target: 'http://localhost:3000',
      }]
    }
  };
  ```

**é…åˆHTTPs**

- https://webpack.docschina.org/configuration/dev-server/#devserver-proxy

**ä»£ç†æ ¹è·¯å¾„**

### å®Œæ•´ä»£ç 

- ```js
  const path = require('path')
  const webpack = require('webpack')
  const HtmlWebpackPlugin = require('html-webpack-plugin')
  const ExtractTextPlugin = require('extract-text-webpack-plugin')
  const CopyWebpackPlugin = require('copy-webpack-plugin')
  
  module.exports = {
    entry: './src/index',
  
    output: {
      path: path.resolve(__dirname, 'dist'),
      filename: '[name].js',
    },
  
    module: {
      rules: [
        {
          enforce: 'pre', // æŒ‡å®šä¸ºå‰ç½®ç±»å‹
          test: /\.jsx?$/,
          exclude: /node_modules/,
          loader: "eslint-loader",
        },
        {
          test: /\.jsx?$/,
          include: [
            path.resolve(__dirname, 'src'),
          ],
          use: 'babel-loader',
        },
        {
          test: /\.css$/,
          use: ExtractTextPlugin.extract({
            fallback: 'style-loader',
            use: [
              'css-loader',
            ],
          }),
        },
        {
          test: /\.less$/,
          use: ExtractTextPlugin.extract({
            fallback: 'style-loader',
            use: [
              'css-loader',
              'less-loader',
            ],
          }),
        },
        {
          test: /\.(png|jpg|gif)$/,
          use: [
            {
              loader: 'file-loader'
            },
          ],
        },
      ],
    },
  
    resolve: {
      alias: {
        utils: path.resolve(__dirname, 'src/utils'), // è¿™é‡Œä½¿ç”¨ path.resolve å’Œ __dirname æ¥è·å–ç»å¯¹è·¯å¾„
        log$: path.resolve(__dirname, 'src/utils/log.js') // åªåŒ¹é… log
      },
      extensions: ['.js', '.json', '.jsx', '.css', '.less'],
      modules: [
        path.resolve(__dirname, 'node_modules'), // æŒ‡å®šå½“å‰ç›®å½•ä¸‹çš„ node_modules ä¼˜å…ˆæŸ¥æ‰¾
      ],
    },
  
    plugins: [
      new HtmlWebpackPlugin({
        filename: 'index.html', // é…ç½®è¾“å‡ºæ–‡ä»¶åå’Œè·¯å¾„
        template: 'src/index.html', // é…ç½®æ–‡ä»¶æ¨¡æ¿
      }),
      new ExtractTextPlugin('[name].css'),
      new webpack.DefinePlugin({
        TWO: '1+1',
        CONSTANTS: {
          APP_VERSION: JSON.stringify('1.1.2'), // const CONSTANTS = { APP_VERSION: '1.1.2' }
        },
      }),
      new CopyWebpackPlugin([
        { from: 'src/assets/favicon.ico', to: 'favicon.ico', }, // é¡¾åæ€ä¹‰ï¼Œfrom é…ç½®æ¥æºï¼Œto é…ç½®ç›®æ ‡è·¯å¾„
      ]),
      new webpack.ProvidePlugin({
        _: 'lodash',
      }),
    ],
  
    devServer: {
      port: '1234',
      before(app){
        app.get('/api/test.json', function(req, res) { // å½“è®¿é—® /some/path è·¯å¾„æ—¶ï¼Œè¿”å›è‡ªå®šä¹‰çš„ json æ•°æ®
          res.json({ code: 200, message: 'hello world' })
        })
      }
    },
  }
  ```

## å¼€å‘å’Œç”Ÿäº§ç¯å¢ƒçš„æ„å»ºé…ç½®å·®å¼‚

+ æˆ‘ä»¬åœ¨æ—¥å¸¸çš„å‰ç«¯å¼€å‘å·¥ä½œä¸­ï¼Œä¸€èˆ¬éƒ½ä¼šæœ‰ä¸¤å¥—æ„å»ºç¯å¢ƒï¼šä¸€å¥—å¼€å‘æ—¶ä½¿ç”¨ï¼Œæ„å»ºç»“æœç”¨äºæœ¬åœ°å¼€å‘è°ƒè¯•ï¼Œä¸è¿›è¡Œä»£ç å‹ç¼©ï¼Œæ‰“å° `debug` ä¿¡æ¯ï¼ŒåŒ…å«`sourcemap` æ–‡ä»¶
+ å¦å¤–ä¸€å¥—æ„å»ºåçš„ç»“æœæ˜¯ç›´æ¥åº”ç”¨äºçº¿ä¸Šçš„ï¼Œå³ä»£ç éƒ½æ˜¯å‹ç¼©åï¼Œè¿è¡Œæ—¶ä¸æ‰“å° `debug` ä¿¡æ¯ï¼Œé™æ€æ–‡ä»¶ä¸åŒ…æ‹¬ `sourcemap` çš„ã€‚æœ‰çš„æ—¶å€™å¯èƒ½è¿˜éœ€è¦å¤šä¸€å¥—æµ‹è¯•ç¯å¢ƒï¼Œåœ¨è¿è¡Œæ—¶ç›´æ¥è¿›è¡Œè¯·æ±‚ `mock` ç­‰å·¥ä½œ
+ `webpack 4.x` ç‰ˆæœ¬å¼•å…¥äº† `mode` çš„æ¦‚å¿µï¼Œåœ¨è¿è¡Œ `webpack` æ—¶éœ€è¦æŒ‡å®šä½¿ç”¨ `production`æˆ– `development` ä¸¤ä¸ª `mode` å…¶ä¸­ä¸€ä¸ªï¼Œè¿™ä¸ªåŠŸèƒ½ä¹Ÿå°±æ˜¯æˆ‘ä»¬æ‰€éœ€è¦çš„è¿è¡Œä¸¤å¥—æ„å»ºç¯å¢ƒçš„èƒ½åŠ›ã€‚

### åœ¨é…ç½®æ–‡ä»¶ä¸­åŒºåˆ† mode

+ ä¹‹å‰æˆ‘ä»¬çš„é…ç½®æ–‡ä»¶éƒ½æ˜¯ç›´æ¥å¯¹å¤–æš´éœ²ä¸€ä¸ª `JS` å¯¹è±¡ï¼Œè¿™ç§æ–¹å¼æš‚æ—¶æ²¡æœ‰åŠæ³•è·å–åˆ° `webpack` çš„ `mode`å‚æ•°ï¼Œæˆ‘ä»¬éœ€è¦æ›´æ¢ä¸€ç§æ–¹å¼æ¥å¤„ç†é…ç½®ã€‚æ ¹æ®å®˜æ–¹çš„æ–‡æ¡£å¤šç§é…ç½®ç±»å‹ï¼Œé…ç½®æ–‡ä»¶å¯ä»¥å¯¹å¤–æš´éœ²ä¸€ä¸ªå‡½æ•°ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥è¿™æ ·åš

  ```js
  module.exports = (env, argv) => ({
    // ... å…¶ä»–é…ç½®
    optimization: {
      minimize: false,
      // ä½¿ç”¨ argv æ¥è·å– mode å‚æ•°çš„å€¼
      minimizer: argv.mode === 'production' ? [
        new UglifyJsPlugin({ /* ä½ è‡ªå·±çš„é…ç½® */ }), 
        // ä»…åœ¨æˆ‘ä»¬è¦è‡ªå®šä¹‰å‹ç¼©é…ç½®æ—¶æ‰éœ€è¦è¿™ä¹ˆåš
        // mode ä¸º production æ—¶ webpack ä¼šé»˜è®¤ä½¿ç”¨å‹ç¼© JS çš„ plugin
      ] : [],
    },
  })...
  ```

- è¿™æ ·è·å– `mode` ä¹‹åï¼Œæˆ‘ä»¬å°±èƒ½å¤ŸåŒºåˆ†ä¸åŒçš„æ„å»ºç¯å¢ƒï¼Œç„¶åæ ¹æ®ä¸åŒç¯å¢ƒå†å¯¹ç‰¹æ®Šçš„ `loader`æˆ–`plugin`åšé¢å¤–çš„é…ç½®å°±å¯ä»¥äº†
- ä»¥ä¸Šæ˜¯ `webpack 4.x` çš„åšæ³•ï¼Œç”±äºæœ‰äº† `mode` å‚æ•°ï¼ŒåŒºåˆ†ç¯å¢ƒå˜å¾—ç®€å•äº†ã€‚ä¸è¿‡åœ¨å½“å‰ä¸šç•Œï¼Œä¼°è®¡è¿˜æ˜¯ä½¿ç”¨ `webpack 3.x` ç‰ˆæœ¬çš„å±…å¤šï¼Œæ‰€ä»¥è¿™é‡Œä¹Ÿç®€å•ä»‹ç»ä¸€ä¸‹ `3.x` å¦‚ä½•åŒºåˆ†ç¯å¢ƒ

### å¸¸è§çš„ç¯å¢ƒå·®å¼‚é…ç½®

- ç”Ÿäº§ç¯å¢ƒå¯èƒ½éœ€è¦åˆ†ç¦» `CSS`æˆå•ç‹¬çš„æ–‡ä»¶ï¼Œä»¥ä¾¿å¤šä¸ªé¡µé¢å…±äº«åŒä¸€ä¸ª `CSS` æ–‡ä»¶
- ç”Ÿäº§ç¯å¢ƒéœ€è¦å‹ç¼© `HTML/CSS/JS` ä»£ç 
- ç”Ÿäº§ç¯å¢ƒéœ€è¦å‹ç¼©å›¾ç‰‡
- å¼€å‘ç¯å¢ƒéœ€è¦ç”Ÿæˆ `sourcemap` æ–‡ä»¶
- å¼€å‘ç¯å¢ƒéœ€è¦æ‰“å° `debug` ä¿¡æ¯
- å¼€å‘ç¯å¢ƒéœ€è¦ `live reload`æˆ–è€… `hot reload` çš„åŠŸèƒ½â€¦
- `webpack 4.x` çš„ `mode` å·²ç»æä¾›äº†ä¸Šè¿°å·®å¼‚é…ç½®çš„å¤§éƒ¨åˆ†åŠŸèƒ½ï¼Œ`mode` ä¸º `production` æ—¶é»˜è®¤ä½¿ç”¨ `JS` ä»£ç å‹ç¼©ï¼Œè€Œ`mode` ä¸º `development` æ—¶é»˜è®¤å¯ç”¨ `hot` `reload`ï¼Œç­‰ç­‰ã€‚è¿™æ ·è®©æˆ‘ä»¬çš„é…ç½®æ›´ä¸ºç®€æ´ï¼Œæˆ‘ä»¬åªéœ€è¦é’ˆå¯¹ç‰¹åˆ«ä½¿ç”¨çš„ `loader` å’Œ `plugin` åšåŒºåˆ†é…ç½®å°±å¯ä»¥äº†â€¦

### æ‹†åˆ†é…ç½®

- å‰é¢æˆ‘ä»¬åˆ—å‡ºäº†å‡ ä¸ªç¯å¢ƒå·®å¼‚é…ç½®ï¼Œå¯èƒ½è¿™äº›æ„å»ºéœ€æ±‚å°±å·²ç»æœ‰ç‚¹å¤šäº†ï¼Œä¼šè®©æ•´ä¸ª `webpack` çš„é…ç½®å˜å¾—å¤æ‚ï¼Œå°¤å…¶æ˜¯æœ‰ç€å¤§é‡ç¯å¢ƒå˜é‡åˆ¤æ–­çš„é…ç½®ã€‚æˆ‘ä»¬å¯ä»¥æŠŠ `webpack` çš„é…ç½®æŒ‰ç…§ä¸åŒçš„ç¯å¢ƒæ‹†åˆ†æˆå¤šä¸ªæ–‡ä»¶ï¼Œè¿è¡Œæ—¶ç›´æ¥æ ¹æ®ç¯å¢ƒå˜é‡åŠ è½½å¯¹åº”çš„é…ç½®å³å¯ã€‚åŸºæœ¬çš„åˆ’åˆ†å¦‚ä¸‹â€¦
  - `webpack.base.js`ï¼šåŸºç¡€éƒ¨åˆ†ï¼Œå³å¤šä¸ªæ–‡ä»¶ä¸­å…±äº«çš„é…ç½®
  - `webpack.development.js`ï¼šå¼€å‘ç¯å¢ƒä½¿ç”¨çš„é…ç½®
  - `webpack.production.js`ï¼šç”Ÿäº§ç¯å¢ƒä½¿ç”¨çš„é…ç½®
  - `webpack.test.js`ï¼šæµ‹è¯•ç¯å¢ƒä½¿ç”¨çš„é…ç½®â€¦

- é¦–å…ˆæˆ‘ä»¬è¦æ˜ç™½ï¼Œå¯¹äº `webpack` çš„é…ç½®ï¼Œå…¶å®æ˜¯å¯¹å¤–æš´éœ²ä¸€ä¸ª `JS` å¯¹è±¡ï¼Œæ‰€ä»¥å¯¹äºè¿™ä¸ªå¯¹è±¡ï¼Œæˆ‘ä»¬éƒ½å¯ä»¥ç”¨ `JS` ä»£ç æ¥ä¿®æ”¹å®ƒï¼Œä¾‹å¦‚

  ```js
  const config = {
    // ... webpack é…ç½®
  }
  
  // æˆ‘ä»¬å¯ä»¥ä¿®æ”¹è¿™ä¸ª config æ¥è°ƒæ•´é…ç½®ï¼Œä¾‹å¦‚æ·»åŠ ä¸€ä¸ªæ–°çš„æ’ä»¶
  config.plugins.push(new YourPlugin());
  
  module.exports = config;...
  ```

- å› æ­¤ï¼Œåªè¦æœ‰ä¸€ä¸ªå·¥å…·èƒ½æ¯”è¾ƒæ™ºèƒ½åœ°åˆå¹¶å¤šä¸ªé…ç½®å¯¹è±¡ï¼Œæˆ‘ä»¬å°±å¯ä»¥å¾ˆè½»æ¾åœ°æ‹†åˆ† webpack é…ç½®ï¼Œç„¶åé€šè¿‡åˆ¤æ–­ç¯å¢ƒå˜é‡ï¼Œä½¿ç”¨å·¥å…·å°†å¯¹åº”ç¯å¢ƒçš„å¤šä¸ªé…ç½®å¯¹è±¡æ•´åˆåæä¾›ç»™ webpack ä½¿ç”¨ã€‚è¿™ä¸ªå·¥å…·å°±æ˜¯ `webpack-merge`



- æˆ‘ä»¬çš„ webpack é…ç½®åŸºç¡€éƒ¨åˆ†ï¼Œå³ `webpack.base.js` åº”è¯¥å¤§è‡´æ˜¯è¿™æ ·çš„

  ```js
  module.exports = {
    entry: '...',
    output: {
      // ...
    },
    resolve: {
      // ...
    },
    module: {
      // è¿™é‡Œæ˜¯ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼Œåé¢ä»‹ç» API æ—¶ä¼šç”¨åˆ°
      rules: [
        {
          test: /\.js$/, 
          use: ['babel'],
        },
      ],
      // ...
    },
    plugins: [
      // ...
    ],
  }...
  ```

- ç„¶å `webpack.development.js` éœ€è¦æ·»åŠ  `loader` æˆ– `plugin`ï¼Œå°±å¯ä»¥ä½¿ç”¨ `webpack-merge`çš„ `API`ï¼Œä¾‹å¦‚

  ```js
  const { smart } = require('webpack-merge')
  const webpack = require('webpack')
  const base = require('./webpack.base.js')
  
  module.exports = smart(base, {
    module: {
      rules: [
        // ç”¨ smart APIï¼Œå½“è¿™é‡Œçš„åŒ¹é…è§„åˆ™ç›¸åŒä¸” use å€¼éƒ½æ˜¯æ•°ç»„æ—¶ï¼Œsmart ä¼šè¯†åˆ«åå¤„ç†
        // å’Œä¸Šè¿° base é…ç½®åˆå¹¶åï¼Œè¿™é‡Œä¼šæ˜¯ { test: /\.js$/, use: ['babel', 'coffee'] }
        // å¦‚æœè¿™é‡Œ use çš„å€¼ç”¨çš„æ˜¯å­—ç¬¦ä¸²æˆ–è€…å¯¹è±¡çš„è¯ï¼Œé‚£ä¹ˆä¼šæ›¿æ¢æ‰åŸæœ¬çš„è§„åˆ™ use çš„å€¼
        {
          test: /\.js$/,
          use: ['coffee'],
        },
        // ...
      ],
    },
    plugins: [
      // plugins è¿™é‡Œçš„æ•°ç»„ä¼šå’Œ base ä¸­çš„ plugins æ•°ç»„è¿›è¡Œåˆå¹¶
      new webpack.DefinePlugin({
        'process.env.NODE_ENV': JSON.stringify(process.env.NODE_ENV),
      }),
    ],
  })...
  ```

- å¯è§ `webpack-merge` æä¾›çš„ `smart` æ–¹æ³•ï¼Œå¯ä»¥å¸®åŠ©æˆ‘ä»¬æ›´åŠ è½»æ¾åœ°å¤„ç† `loader` é…ç½®çš„åˆå¹¶ã€‚`webpack-merge` è¿˜æœ‰å…¶ä»– `API` å¯ä»¥ç”¨äºè‡ªå®šä¹‰åˆå¹¶è¡Œä¸º <https://github.com/survivejs/webpack-merge>

### å®Œæ•´ä»£ç 

- webpack.config.js

  ```js
  module.exports = function(env, argv) {
    return argv.mode === 'production' ?
      require('./configs/webpack.production') :
      require('./configs/webpack.development')
  }
  ```

- configs/webpack.base.js

  ```js
  const path = require('path')
  const HtmlWebpackPlugin = require('html-webpack-plugin')
  
  module.exports = {
    entry: './src/index.js',
  
    output: {
      path: path.resolve(__dirname, '../dist'),
      filename: '[name].js',
    },
  
    module: {
      rules: [
        {
          test: /\.jsx?/,
          include: [
            path.resolve(__dirname, '../src'),
          ],
          use: 'babel-loader',
        },
        {
          test: /\.(png|jpg|gif)$/,
          use: [
            {
              loader: 'file-loader'
            },
          ],
        },
      ],
    },
  
    plugins: [
      new HtmlWebpackPlugin({
        filename: 'index.html', // é…ç½®è¾“å‡ºæ–‡ä»¶åå’Œè·¯å¾„
        template: 'src/index.html', // é…ç½®æ–‡ä»¶æ¨¡æ¿
      }),
    ],
  }
  ```

- configs/webpack.development.js

  ```js
  const webpack = require('webpack')
  const merge = require('webpack-merge')
  const baseConfig = require('./webpack.base')
  
  const config = merge.smart(baseConfig, {
    module: {
      rules: [
        {
          enforce: 'pre',
          test: /\.jsx?$/,
          exclude: /node_modules/,
          loader: "eslint-loader",
        },
        {
          test: /\.less$/,
          use: [
            'style-loader',
            'css-loader',
            'less-loader'
          ],
        },
      ],
    },
  
    devServer: {
      port: '1234',
      before(app){
        app.get('/api/test.json', function(req, res) {
          res.json({ code: 200, message: 'hello world' })
        })
      },
    },
  })
  
  config.plugins.push(
    new webpack.DefinePlugin({
      __DEV__: JSON.stringify(true),
    })
  )
  
  module.exports = config
  ```

- configs/webpack.production.js

  ```js
  const merge = require('webpack-merge')
  const ExtractTextPlugin = require('extract-text-webpack-plugin')
  const baseConfig = require('./webpack.base')
  
  const config = merge.smart(baseConfig, {
    module: {
      rules: [
        {
          test: /\.less$/,
          use: ExtractTextPlugin.extract({
            fallback: 'style-loader',
            use: [
              {
                loader: 'css-loader',
                options: {
                  minimize: true
                }
              },
              'less-loader',
            ],
          }),
        },
      ],
    }
  })
  
  config.plugins.push(new ExtractTextPlugin('[name].css'))
  
  module.exports = config
  ```

### åˆ†åˆ«å¼•ç”¨

- package.json

  ```json
    "scripts": {
      "test": "echo \"Error: no test specified\" && exit 1",
      "dev": "webpack-dev-server --hot --inline --progress --colors --config config/webpack.dev.conf.js",
      "start": "npm run dev",
      "build": "webpack --progress --colors --config config/webpack.prod.conf.js"
    }
  ```

- ä¸åŒçš„å‘½ä»¤æ‰§è¡Œä¸åŒçš„webpack.config

## æ¨¡å—çƒ­æ›¿æ¢æé«˜å¼€å‘æ•ˆç‡

- `HMR` å…¨ç§°æ˜¯ `Hot Module Replacement`ï¼Œå³æ¨¡å—çƒ­æ›¿æ¢ã€‚åœ¨è¿™ä¸ªæ¦‚å¿µå‡ºæ¥ä¹‹å‰ï¼Œæˆ‘ä»¬ä½¿ç”¨è¿‡ `Hot Reloading`ï¼Œå½“ä»£ç å˜æ›´æ—¶é€šçŸ¥æµè§ˆå™¨åˆ·æ–°é¡µé¢ï¼Œä»¥é¿å…é¢‘ç¹æ‰‹åŠ¨åˆ·æ–°æµè§ˆå™¨é¡µé¢ã€‚HMR å¯ä»¥ç†è§£ä¸ºå¢å¼ºç‰ˆçš„ `Hot Reloading`ï¼Œä½†ä¸ç”¨æ•´ä¸ªé¡µé¢åˆ·æ–°ï¼Œè€Œæ˜¯å±€éƒ¨æ›¿æ¢æ‰éƒ¨åˆ†æ¨¡å—ä»£ç å¹¶ä¸”ä½¿å…¶ç”Ÿæ•ˆï¼Œå¯ä»¥çœ‹åˆ°ä»£ç å˜æ›´åçš„æ•ˆæœã€‚æ‰€ä»¥ï¼Œ`HMR` æ—¢é¿å…äº†é¢‘ç¹æ‰‹åŠ¨åˆ·æ–°é¡µé¢ï¼Œä¹Ÿå‡å°‘äº†é¡µé¢åˆ·æ–°æ—¶çš„ç­‰å¾…ï¼Œå¯ä»¥æå¤§åœ°æé«˜å‰ç«¯é¡µé¢å¼€å‘æ•ˆç‡â€¦

### é…ç½®ä½¿ç”¨ HMR

- `HMR` æ˜¯ `webpack` æä¾›çš„éå¸¸æœ‰ç”¨çš„ä¸€ä¸ªåŠŸèƒ½ï¼Œè·Ÿæˆ‘ä»¬ä¹‹å‰æåˆ°çš„ä¸€æ ·ï¼Œå®‰è£…å¥½ `webpack-dev-server`ï¼Œ æ·»åŠ ä¸€äº›ç®€å•çš„é…ç½®ï¼Œå³åœ¨`webpack` çš„é…ç½®æ–‡ä»¶ä¸­æ·»åŠ å¯ç”¨`HMR`éœ€è¦çš„ä¸¤ä¸ªæ’ä»¶

  ```js
  const webpack = require('webpack')
  
  module.exports = {
    // ...
    devServer: {
      hot: true // dev server çš„é…ç½®è¦å¯åŠ¨ hotï¼Œæˆ–è€…åœ¨å‘½ä»¤è¡Œä¸­å¸¦å‚æ•°å¼€å¯
    },
    plugins: [
      // ...
      new webpack.NamedModulesPlugin(), // ç”¨äºå¯åŠ¨ HMR æ—¶å¯ä»¥æ˜¾ç¤ºæ¨¡å—çš„ç›¸å¯¹è·¯å¾„
      new webpack.HotModuleReplacementPlugin(), // Hot Module Replacement çš„æ’ä»¶
    ],
  }...
  ```

### module.hot å¸¸è§çš„ API

- å‰é¢ `HMR`å®ç°éƒ¨åˆ†å·²ç»è®²è§£äº†å®ç° HMR æ¥å£çš„é‡è¦æ€§ï¼Œä¸‹é¢æ¥çœ‹çœ‹å¸¸è§çš„ `module.hot` `API` æœ‰å“ªäº›ï¼Œä»¥åŠå¦‚ä½•ä½¿ç”¨

- `module.hot.accept` æ–¹æ³•æŒ‡å®šåœ¨åº”ç”¨ç‰¹å®šä»£ç æ¨¡å—æ›´æ–°æ—¶æ‰§è¡Œç›¸åº”çš„ `callback`ï¼Œç¬¬ä¸€ä¸ªå‚æ•°å¯ä»¥æ˜¯å­—ç¬¦ä¸²æˆ–è€…æ•°ç»„ï¼Œå¦‚

  ```js
  if (module.hot) {
    module.hot.accept(['./bar.js', './index.css'], () => {
      // ... è¿™æ ·å½“ bar.js æˆ–è€… index.css æ›´æ–°æ—¶éƒ½ä¼šæ‰§è¡Œè¯¥å‡½æ•°
    })
  }...
  ```

- `module.hot.decline` å¯¹äºæŒ‡å®šçš„ä»£ç æ¨¡å—ï¼Œæ‹’ç»è¿›è¡Œæ¨¡å—ä»£ç çš„æ›´æ–°ï¼Œè¿›å…¥æ›´æ–°å¤±è´¥çŠ¶æ€ï¼Œå¦‚ `module.hot.decline('./bar.js')`ã€‚è¿™ä¸ªæ–¹æ³•æ¯”è¾ƒå°‘ç”¨åˆ°

- `module.hot.dispose` ç”¨äºæ·»åŠ ä¸€ä¸ªå¤„ç†å‡½æ•°ï¼Œåœ¨å½“å‰æ¨¡å—ä»£ç è¢«æ›¿æ¢æ—¶è¿è¡Œè¯¥å‡½æ•°ï¼Œä¾‹å¦‚

  ```js
  if (module.hot) {
    module.hot.dispose((data) => {
      // data ç”¨äºä¼ é€’æ•°æ®ï¼Œå¦‚æœæœ‰éœ€è¦ä¼ é€’çš„æ•°æ®å¯ä»¥æŒ‚åœ¨ data å¯¹è±¡ä¸Šï¼Œç„¶ååœ¨æ¨¡å—ä»£ç æ›´æ–°åå¯ä»¥é€šè¿‡ module.hot.data æ¥è·å–
    })
  }...
  ```

- `module.hot.accept` é€šå¸¸ç”¨äºæŒ‡å®šå½“å‰ä¾èµ–çš„æŸä¸ªæ¨¡å—æ›´æ–°æ—¶éœ€è¦åšçš„å¤„ç†ï¼Œå¦‚æœæ˜¯å½“å‰æ¨¡å—æ›´æ–°æ—¶éœ€è¦å¤„ç†çš„åŠ¨ä½œï¼Œä½¿ç”¨ `module.hot.dispose` ä¼šæ›´åŠ å®¹æ˜“æ–¹ä¾¿

- `module.hot.removeDisposeHandler`ç”¨äºç§»é™¤ `dispose` æ–¹æ³•æ·»åŠ çš„ `callback`

## å›¾ç‰‡åŠ è½½ä¼˜åŒ–

### CSS Sprites

- å¦‚æœä½ ä½¿ç”¨çš„ `webpack 3.x` ç‰ˆæœ¬ï¼Œéœ€è¦ `CSS Sprites` çš„è¯ï¼Œå¯ä»¥ä½¿ç”¨ `webpack-spritesmith` æˆ–è€… `sprite-webpack-plugin`ã€‚

- æˆ‘ä»¬ä»¥ `webpack-spritesmith` ä¸ºä¾‹ï¼Œå…ˆå®‰è£…ä¾èµ–â€¦

  ```js
  module: {
    loaders: [
      // ... è¿™é‡Œéœ€è¦æœ‰å¤„ç†å›¾ç‰‡çš„ loaderï¼Œå¦‚ file-loader
    ]
  },
  resolve: {
    modules: [
      'node_modules', 
      'spritesmith-generated', // webpack-spritesmith ç”Ÿæˆæ‰€éœ€æ–‡ä»¶çš„ç›®å½•
    ],
  },
  plugins: [
    new SpritesmithPlugin({
      src: {
        cwd: path.resolve(__dirname, 'src/ico'), // å¤šä¸ªå›¾ç‰‡æ‰€åœ¨çš„ç›®å½•
        glob: '*.png' // åŒ¹é…å›¾ç‰‡çš„è·¯å¾„
      },
      target: {
        // ç”Ÿæˆæœ€ç»ˆå›¾ç‰‡çš„è·¯å¾„
        image: path.resolve(__dirname, 'src/spritesmith-generated/sprite.png'), 
        // ç”Ÿæˆæ‰€éœ€ SASS/LESS/Stylus mixins ä»£ç ï¼Œæˆ‘ä»¬ä½¿ç”¨ Stylus é¢„å¤„ç†å™¨åšä¾‹å­
        css: path.resolve(__dirname, 'src/spritesmith-generated/sprite.styl'), 
      },
      apiOptions: {
        cssImageRef: "~sprite.png"
      },
    }),
  ],...
  ```

- åœ¨ä½ éœ€è¦çš„æ ·å¼ä»£ç ä¸­å¼•å…¥ `sprite.styl` åè°ƒç”¨éœ€è¦çš„`mixins` å³å¯

  ```js
  @import '~sprite.styl'
  
  .close-button
      sprite($close)
  .open-button
      sprite($open)
  ```

- å¦‚æœä½ ä½¿ç”¨çš„æ˜¯ `webpack 4.x`ï¼Œä½ éœ€è¦é…åˆä½¿ç”¨ `postcss`å’Œ `postcss-sprites`ï¼Œæ‰èƒ½å®ç° `CSS Sprites` çš„ç›¸å…³æ„å»º

### å›¾ç‰‡å‹ç¼©

- åœ¨ä¸€èˆ¬çš„é¡¹ç›®ä¸­ï¼Œå›¾ç‰‡èµ„æºä¼šå å‰ç«¯èµ„æºçš„å¾ˆå¤§ä¸€éƒ¨åˆ†ï¼Œæ—¢ç„¶ä»£ç éƒ½è¿›è¡Œå‹ç¼©äº†ï¼Œå å¤§å¤´çš„å›¾ç‰‡å°±æ›´ä¸ç”¨è¯´äº†

- æˆ‘ä»¬ä¹‹å‰æåŠä½¿ç”¨`file-loader` æ¥å¤„ç†å›¾ç‰‡æ–‡ä»¶ï¼Œåœ¨æ­¤åŸºç¡€ä¸Šï¼Œæˆ‘ä»¬å†æ·»åŠ ä¸€ä¸ª `image-webpack-loader`æ¥å‹ç¼©å›¾ç‰‡æ–‡ä»¶ã€‚ç®€å•çš„é…ç½®å¦‚ä¸‹â€¦

  ```js
  module.exports = {
    // ...
    module: {
      rules: [
        {
          test: /.*\.(gif|png|jpe?g|svg|webp)$/i,
          use: [
            {
              loader: 'file-loader',
              options: {}
            },
            {
              loader: 'image-webpack-loader',
              options: {
                mozjpeg: { // å‹ç¼© jpeg çš„é…ç½®
                  progressive: true,
                  quality: 65
                },
                optipng: { // ä½¿ç”¨ imagemin-optipng å‹ç¼© pngï¼Œenable: false ä¸ºå…³é—­
                  enabled: false,
                },
                pngquant: { // ä½¿ç”¨ imagemin-pngquant å‹ç¼© png
                  quality: '65-90',
                  speed: 4
                },
                gifsicle: { // å‹ç¼© gif çš„é…ç½®
                  interlaced: false,
                },
                webp: { // å¼€å¯ webpï¼Œä¼šæŠŠ jpg å’Œ png å›¾ç‰‡å‹ç¼©ä¸º webp æ ¼å¼
                  quality: 75
                },
            },
          ],
        },
      ],
    },
  }...
  ```

### ä½¿ç”¨ DataURL

- æœ‰çš„æ—¶å€™æˆ‘ä»¬çš„é¡¹ç›®ä¸­ä¼šæœ‰ä¸€äº›å¾ˆå°çš„å›¾ç‰‡ï¼Œå› ä¸ºæŸäº›ç¼˜æ•…å¹¶ä¸æƒ³ä½¿ç”¨ `CSS Sprites` çš„æ–¹å¼æ¥å¤„ç†ï¼ˆè­¬å¦‚å°å›¾ç‰‡ä¸å¤šï¼Œå› æ­¤å¼•å…¥ CSS Sprites æ„Ÿè§‰éº»çƒ¦ï¼‰ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥åœ¨ webpack ä¸­ä½¿ç”¨ `url-loader` æ¥å¤„ç†è¿™äº›å¾ˆå°çš„å›¾ç‰‡â€¦
- `url-loader` å’Œ `file-loader` çš„åŠŸèƒ½ç±»ä¼¼ï¼Œä½†æ˜¯åœ¨å¤„ç†æ–‡ä»¶çš„æ—¶å€™ï¼Œå¯ä»¥é€šè¿‡é…ç½®æŒ‡å®šä¸€ä¸ªå¤§å°ï¼Œå½“æ–‡ä»¶å°äºè¿™ä¸ªé…ç½®å€¼æ—¶ï¼Œ`url-loader` ä¼šå°†å…¶è½¬æ¢ä¸ºä¸€ä¸ª `base64` ç¼–ç çš„ `DataURL`

## ä»£ç å‹ç¼©

- `webpack 4.x` ç‰ˆæœ¬è¿è¡Œæ—¶ï¼Œ`mode` ä¸º `production` å³ä¼šå¯åŠ¨å‹ç¼© `JS` ä»£ç çš„æ’ä»¶ï¼Œè€Œå¯¹äº `webpack` `3.x`ï¼Œä½¿ç”¨å‹ç¼© `JS` ä»£ç æ’ä»¶çš„æ–¹å¼ä¹Ÿå·²ç»ä»‹ç»è¿‡äº†ã€‚åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œå‹ç¼© `JS` ä»£ç åŸºæœ¬æ˜¯ä¸€ä¸ªå¿…ä¸å¯å°‘çš„æ­¥éª¤ï¼Œè¿™æ ·å¯ä»¥å¤§å¤§å‡å° `JavaScript` çš„ä½“ç§¯ï¼Œç›¸å…³å†…å®¹è¿™é‡Œä¸å†èµ˜è¿°ã€‚

- é™¤äº† JS ä»£ç ä¹‹å¤–ï¼Œæˆ‘ä»¬ä¸€èˆ¬è¿˜éœ€è¦ HTML å’Œ CSS æ–‡ä»¶ï¼Œè¿™ä¸¤ç§æ–‡ä»¶ä¹Ÿéƒ½æ˜¯å¯ä»¥å‹ç¼©çš„ï¼Œè™½ç„¶ä¸åƒ JS çš„å‹ç¼©é‚£ä¹ˆå½»åº•ï¼ˆæ›¿æ¢æ‰é•¿å˜é‡ç­‰ï¼‰ï¼Œåªèƒ½ç§»é™¤ç©ºæ ¼æ¢è¡Œç­‰æ— ç”¨å­—ç¬¦ï¼Œä½†ä¹Ÿèƒ½åœ¨ä¸€å®šç¨‹åº¦ä¸Šå‡å°æ–‡ä»¶å¤§å°ã€‚åœ¨ webpack ä¸­çš„é…ç½®ä½¿ç”¨ä¹Ÿä¸æ˜¯ç‰¹åˆ«éº»çƒ¦ï¼Œæ‰€ä»¥æˆ‘ä»¬é€šå¸¸ä¹Ÿä¼šä½¿ç”¨ã€‚

- å¯¹äº HTML æ–‡ä»¶ï¼Œä¹‹å‰ä»‹ç»çš„ `html-webpack-plugin` æ’ä»¶å¯ä»¥å¸®åŠ©æˆ‘ä»¬ç”Ÿæˆéœ€è¦çš„ HTML å¹¶å¯¹å…¶è¿›è¡Œå‹ç¼©â€¦

  ```js
  module.exports = {
    // ...
    plugins: [
      new HtmlWebpackPlugin({
        filename: 'index.html', // é…ç½®è¾“å‡ºæ–‡ä»¶åå’Œè·¯å¾„
        template: 'assets/index.html', // é…ç½®æ–‡ä»¶æ¨¡æ¿
        minify: { // å‹ç¼© HTML çš„é…ç½®
          minifyCSS: true, // å‹ç¼© HTML ä¸­å‡ºç°çš„ CSS ä»£ç 
          minifyJS: true // å‹ç¼© HTML ä¸­å‡ºç°çš„ JS ä»£ç 
        }
      }),
    ],
  }...
  ```

- å¦‚ä¸Šï¼Œä½¿ç”¨ `minify` å­—æ®µé…ç½®å°±å¯ä»¥ä½¿ç”¨ `HTML` å‹ç¼©ï¼Œè¿™ä¸ªæ’ä»¶æ˜¯ä½¿ç”¨ `html-minifier` æ¥å®ç°`HTML` ä»£ç å‹ç¼©çš„ï¼Œ`minify`ä¸‹çš„é…ç½®é¡¹ç›´æ¥é€ä¼ ç»™ `html-minifier`ï¼Œé…ç½®é¡¹å‚è€ƒ `html-minifier` æ–‡æ¡£å³å¯ã€‚

- å¯¹äº CSS æ–‡ä»¶ï¼Œæˆ‘ä»¬ä¹‹å‰ä»‹ç»è¿‡ç”¨æ¥å¤„ç† CSS æ–‡ä»¶çš„ `css-loader`ï¼Œä¹Ÿæä¾›äº†å‹ç¼© CSS ä»£ç çš„åŠŸèƒ½ï¼šâ€¦

  ```js
  module.exports = {
    module: {
      rules: [
        // ...
        {
          test: /\.css/,
          include: [
            path.resolve(__dirname, 'src'),
          ],
          use: [
            'style-loader',
            {
              loader: 'css-loader',
              options: {
                minimize: true, // ä½¿ç”¨ css çš„å‹ç¼©åŠŸèƒ½
              },
            },
          ],
        },
      ],
    }
  }...
  ```

- åœ¨ `css-loader` çš„é€‰é¡¹ä¸­é…ç½® `minimize` å­—æ®µä¸º `true`æ¥ä½¿ç”¨`CSS` å‹ç¼©ä»£ç çš„åŠŸèƒ½ã€‚`css-loader` æ˜¯ä½¿ç”¨ `cssnano`æ¥å‹ç¼©ä»£ç çš„ï¼Œ`minimize` å­—æ®µä¹Ÿå¯ä»¥é…ç½®ä¸ºä¸€ä¸ªå¯¹è±¡ï¼Œæ¥å°†ç›¸å…³é…ç½®ä¼ é€’ç»™ `cssnano`â€¦

## åˆ†ç¦»ä»£ç æ–‡ä»¶

- å…³äºåˆ†ç¦» CSS æ–‡ä»¶è¿™ä¸ªä¸»é¢˜ï¼Œä¹‹å‰åœ¨ä»‹ç»å¦‚ä½•æ­å»ºåŸºæœ¬çš„å‰ç«¯å¼€å‘ç¯å¢ƒæ—¶æœ‰æåŠï¼Œåœ¨ `webpack` ä¸­ä½¿ç”¨ `extract-text-webpack-plugin` æ’ä»¶å³å¯ã€‚

- å…ˆç®€å•è§£é‡Šä¸€ä¸‹ä¸ºä½•è¦æŠŠ CSS æ–‡ä»¶åˆ†ç¦»å‡ºæ¥ï¼Œè€Œä¸æ˜¯ç›´æ¥ä¸€èµ·æ‰“åŒ…åœ¨ JS ä¸­ã€‚æœ€ä¸»è¦çš„åŸå› æ˜¯æˆ‘ä»¬å¸Œæœ›æ›´å¥½åœ°åˆ©ç”¨ç¼“å­˜ã€‚

- å‡è®¾æˆ‘ä»¬åŸæœ¬é¡µé¢çš„é™æ€èµ„æºéƒ½æ‰“åŒ…æˆä¸€ä¸ª JS æ–‡ä»¶ï¼ŒåŠ è½½é¡µé¢æ—¶è™½ç„¶åªéœ€è¦åŠ è½½ä¸€ä¸ª JS æ–‡ä»¶ï¼Œä½†æ˜¯æˆ‘ä»¬çš„ä»£ç ä¸€æ—¦æ”¹å˜äº†ï¼Œç”¨æˆ·è®¿é—®æ–°çš„é¡µé¢æ—¶å°±éœ€è¦é‡æ–°åŠ è½½ä¸€ä¸ªæ–°çš„ JS æ–‡ä»¶ã€‚æœ‰äº›æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬åªæ˜¯å•ç‹¬ä¿®æ”¹äº†æ ·å¼ï¼Œè¿™æ ·ä¹Ÿè¦é‡æ–°åŠ è½½æ•´ä¸ªåº”ç”¨çš„ JS æ–‡ä»¶ï¼Œç›¸å½“ä¸åˆ’ç®—ã€‚

- è¿˜æœ‰ä¸€ç§æƒ…å†µæ˜¯æˆ‘ä»¬æœ‰å¤šä¸ªé¡µé¢ï¼Œå®ƒä»¬éƒ½å¯ä»¥å…±ç”¨ä¸€éƒ¨åˆ†æ ·å¼ï¼ˆè¿™æ˜¯å¾ˆå¸¸è§çš„ï¼ŒCSS Resetã€åŸºç¡€ç»„ä»¶æ ·å¼ç­‰åŸºæœ¬éƒ½æ˜¯è·¨é¡µé¢é€šç”¨ï¼‰ï¼Œå¦‚æœæ¯ä¸ªé¡µé¢éƒ½å•ç‹¬æ‰“åŒ…ä¸€ä¸ª JS æ–‡ä»¶ï¼Œé‚£ä¹ˆæ¯æ¬¡è®¿é—®é¡µé¢éƒ½ä¼šé‡å¤åŠ è½½åŸæœ¬å¯ä»¥å…±äº«çš„é‚£äº› CSS ä»£ç ã€‚å¦‚æœåˆ†ç¦»å¼€æ¥ï¼Œç¬¬äºŒä¸ªé¡µé¢å°±æœ‰äº† CSS æ–‡ä»¶çš„ç¼“å­˜ï¼Œè®¿é—®é€Ÿåº¦è‡ªç„¶ä¼šåŠ å¿«ã€‚è™½ç„¶å¯¹ç¬¬ä¸€ä¸ªé¡µé¢æ¥è¯´å¤šäº†ä¸€ä¸ªè¯·æ±‚ï¼Œä½†æ˜¯å¯¹éšåçš„é¡µé¢æ¥è¯´ï¼Œç¼“å­˜å¸¦æ¥çš„é€Ÿåº¦æå‡ç›¸å¯¹æ›´åŠ å¯è§‚â€¦

- `3.x` ä»¥å‰çš„ç‰ˆæœ¬æ˜¯ä½¿ç”¨ `CommonsChunkPlugin` æ¥åšä»£ç åˆ†ç¦»çš„ï¼Œè€Œ `webpack 4.x` åˆ™æ˜¯æŠŠç›¸å…³çš„åŠŸèƒ½åŒ…åˆ°äº†`optimize.splitChunks` ä¸­ï¼Œç›´æ¥ä½¿ç”¨è¯¥é…ç½®å°±å¯ä»¥å®ç°ä»£ç åˆ†ç¦»ã€‚

  ```js
  module.exports = {
    // ... webpack é…ç½®
  
    optimization: {
      splitChunks: {
        chunks: "all", // æ‰€æœ‰çš„ chunks ä»£ç å…¬å…±çš„éƒ¨åˆ†åˆ†ç¦»å‡ºæ¥æˆä¸ºä¸€ä¸ªå•ç‹¬çš„æ–‡ä»¶
      },
    },
  }...
  ```

- æˆ‘ä»¬éœ€è¦åœ¨ HTML ä¸­å¼•ç”¨ä¸¤ä¸ªæ„å»ºå‡ºæ¥çš„ JS æ–‡ä»¶ï¼Œå¹¶ä¸” `commons.js` éœ€è¦åœ¨å…¥å£ä»£ç ä¹‹å‰ã€‚ä¸‹é¢æ˜¯ä¸ªç®€å•çš„ä¾‹å­

  ```html
  <script src="commons.js" charset="utf-8"></script>
  <script src="entry.bundle.js" charset="utf-8"></script>
  ```

- å¦‚æœä½ ä½¿ç”¨äº† `html-webpack-plugin`ï¼Œé‚£ä¹ˆå¯¹åº”éœ€è¦çš„ JS æ–‡ä»¶éƒ½ä¼šåœ¨ HTML æ–‡ä»¶ä¸­æ­£ç¡®å¼•ç”¨ï¼Œä¸ç”¨æ‹…å¿ƒã€‚å¦‚æœæ²¡æœ‰ä½¿ç”¨ï¼Œé‚£ä¹ˆä½ éœ€è¦ä» `stats` çš„ `entrypoints` å±æ€§æ¥è·å–å…¥å£åº”è¯¥å¼•ç”¨å“ªäº› JS æ–‡ä»¶ï¼Œå¯ä»¥å‚è€ƒ Node API äº†è§£å¦‚ä½•ä» stats ä¸­è·å–ä¿¡æ¯â€¦

### **æ˜¾å¼é…ç½®å…±äº«ç±»åº“å¯ä»¥è¿™ä¹ˆæ“ä½œ**

- ```js
  module.exports = {
    entry: {
      vendor: ["react", "lodash", "angular", ...], // æŒ‡å®šå…¬å…±ä½¿ç”¨çš„ç¬¬ä¸‰æ–¹ç±»åº“
    },
    optimization: {
      splitChunks: {
        cacheGroups: {
          vendor: {
            chunks: "initial",
            test: "vendor",
            name: "vendor", // ä½¿ç”¨ vendor å…¥å£ä½œä¸ºå…¬å…±éƒ¨åˆ†
            enforce: true,
          },
        },
      },
    },
    // ... å…¶ä»–é…ç½®
  }
  
  // æˆ–è€…
  module.exports = {
    optimization: {
      splitChunks: {
        cacheGroups: {
          vendor: {
            test: /react|angluar|lodash/, // ç›´æ¥ä½¿ç”¨ test æ¥åšè·¯å¾„åŒ¹é…
            chunks: "initial",
            name: "vendor",
            enforce: true,
          },
        },
      },
    },
  }
  
  // æˆ–è€…
  module.exports = {
    optimization: {
      splitChunks: {
        cacheGroups: {
          vendor: {
            chunks: "initial",
            test: path.resolve(__dirname, "node_modules") // è·¯å¾„åœ¨ node_modules ç›®å½•ä¸‹çš„éƒ½ä½œä¸ºå…¬å…±éƒ¨åˆ†
            name: "vendor", // ä½¿ç”¨ vendor å…¥å£ä½œä¸ºå…¬å…±éƒ¨åˆ†
            enforce: true,
          },
        },
      },
    },
  }...
  ```

- ä¸Šè¿°ç¬¬ä¸€ç§åšæ³•æ˜¯æ˜¾ç¤ºæŒ‡å®šå“ªäº›ç±»åº“ä½œä¸ºå…¬å…±éƒ¨åˆ†ï¼Œç¬¬äºŒç§åšæ³•å®ç°çš„åŠŸèƒ½å·®ä¸å¤šï¼Œåªæ˜¯åˆ©ç”¨äº† test æ¥åšæ¨¡å—è·¯å¾„çš„åŒ¹é…ï¼Œç¬¬ä¸‰ç§åšæ³•æ˜¯æŠŠæ‰€æœ‰åœ¨ node_modules ä¸‹çš„æ¨¡å—ï¼Œå³ä½œä¸ºä¾èµ–å®‰è£…çš„ï¼Œéƒ½ä½œä¸ºå…¬å…±éƒ¨åˆ†ã€‚ä½ å¯ä»¥é’ˆå¯¹é¡¹ç›®æƒ…å†µï¼Œé€‰æ‹©æœ€åˆé€‚çš„åšæ³•..

## è¿›ä¸€æ­¥æ§åˆ¶JSå¤§å°

### æŒ‰éœ€åŠ è½½æ¨¡å—

- åœ¨ webpack çš„æ„å»ºç¯å¢ƒä¸­ï¼Œè¦æŒ‰éœ€åŠ è½½ä»£ç æ¨¡å—å¾ˆç®€å•ï¼Œéµå¾ª ES æ ‡å‡†çš„åŠ¨æ€åŠ è½½è¯­æ³• `dynamic-import` æ¥ç¼–å†™ä»£ç å³å¯ï¼Œ`webpack` ä¼šè‡ªåŠ¨å¤„ç†ä½¿ç”¨è¯¥è¯­æ³•ç¼–å†™çš„æ¨¡å—

  ```js
  // import ä½œä¸ºä¸€ä¸ªæ–¹æ³•ä½¿ç”¨ï¼Œä¼ å…¥æ¨¡å—åå³å¯ï¼Œè¿”å›ä¸€ä¸ª promise æ¥è·å–æ¨¡å—æš´éœ²çš„å¯¹è±¡
  // æ³¨é‡Š webpackChunkName: "lodash" å¯ä»¥ç”¨äºæŒ‡å®š chunk çš„åç§°ï¼Œåœ¨è¾“å‡ºæ–‡ä»¶æ—¶æœ‰ç”¨
  import(/* webpackChunkName: "lodash" */ 'lodash').then((_) => { 
    console.log(_.lash([1, 2, 3])) // æ‰“å° 3
  })...
  ```

- æ³¨æ„ä¸€ä¸‹ï¼Œå¦‚æœä½ ä½¿ç”¨äº† `Babel` çš„è¯ï¼Œè¿˜éœ€è¦ `Syntax Dynamic Import` è¿™ä¸ª `Babel` æ’ä»¶æ¥å¤„ç† `import()` è¿™ç§è¯­æ³•ã€‚

- ç”±äºåŠ¨æ€åŠ è½½ä»£ç æ¨¡å—çš„è¯­æ³•ä¾èµ–äº `promise`ï¼Œå¯¹äºä½ç‰ˆæœ¬çš„æµè§ˆå™¨ï¼Œéœ€è¦æ·»åŠ  `promise` çš„ `polyfill` åæ‰èƒ½ä½¿ç”¨ã€‚

- å¦‚ä¸Šçš„ä»£ç ï¼Œwebpack æ„å»ºæ—¶ä¼šè‡ªåŠ¨æŠŠ `lodash` æ¨¡å—åˆ†ç¦»å‡ºæ¥ï¼Œå¹¶ä¸”åœ¨ä»£ç å†…éƒ¨å®ç°åŠ¨æ€åŠ è½½ `lodash` çš„åŠŸèƒ½ã€‚åŠ¨æ€åŠ è½½ä»£ç æ—¶ä¾èµ–äºç½‘ç»œï¼Œå…¶æ¨¡å—å†…å®¹ä¼šå¼‚æ­¥è¿”å›ï¼Œæ‰€ä»¥ import æ–¹æ³•æ˜¯è¿”å›ä¸€ä¸ª `promise` æ¥è·å–åŠ¨æ€åŠ è½½çš„æ¨¡å—å†…å®¹ã€‚

- `import` åé¢çš„æ³¨é‡Š `webpackChunkName: "lodash"` ç”¨äºå‘ŠçŸ¥ `webpack`æ‰€è¦åŠ¨æ€åŠ è½½æ¨¡å—çš„åç§°ã€‚æˆ‘ä»¬åœ¨ webpack é…ç½®ä¸­æ·»åŠ ä¸€ä¸ª `output.chunkFilename` çš„é…ç½®â€¦

  ```js
  output: {
    path: path.resolve(__dirname, 'dist'),
    filename: '[name].[hash:8].js',
    chunkFilename: '[name].[hash:8].js' // æŒ‡å®šåˆ†ç¦»å‡ºæ¥çš„ä»£ç æ–‡ä»¶çš„åç§°
  },...
  ```

- è¿™æ ·å°±å¯ä»¥æŠŠåˆ†ç¦»å‡ºæ¥çš„æ–‡ä»¶åç§°ç”¨ lodash æ ‡è¯†äº†ï¼Œå¦‚ä¸‹å›¾ï¼š

  ![image.png](F:\OneDrive\JS\assets\4.7 è‡ªåŠ¨åŒ–æ„å»ºä¸æµ‹è¯•\1480597-ae36b6816feed422.png)

- å¦‚æœæ²¡æœ‰æ·»åŠ æ³¨é‡Š `webpackChunkName: "lodash" ä»¥åŠ output.chunkFilename` é…ç½®ï¼Œé‚£ä¹ˆåˆ†ç¦»å‡ºæ¥çš„æ–‡ä»¶åç§°ä¼šä»¥ç®€å•æ•°å­—çš„æ–¹å¼æ ‡è¯†ï¼Œä¸ä¾¿äºè¯†åˆ«

### å®Œæ•´ä»£ç 

- ```js
  const path = require('path')
  const webpack = require('webpack')
  const HtmlWebpackPlugin = require('html-webpack-plugin')
  const ExtractTextPlugin = require('extract-text-webpack-plugin')
  
  module.exports = {
    entry: './src/index.js',
  
    output: {
      path: path.resolve(__dirname, 'dist'),
      filename: '[name].js',
    },
  
    module: {
      rules: [
        {
          test: /\.jsx?/,
          include: [
            path.resolve(__dirname, 'src'),
          ],
          use: 'babel-loader',
        },
        {
          test: /\.less$/,
          use: ExtractTextPlugin.extract({
            fallback: 'style-loader',
            use: [
              'css-loader',
              'postcss-loader',
              'less-loader',
            ],
          }),
        },
        {
          test: /\.(png|jpg|gif)$/,
          use: [
            {
              loader: 'url-loader',
              options: {
                limit: 8192
              },
            },
            {
              loader: 'image-webpack-loader',
              options: {
                mozjpeg: { // å‹ç¼© jpeg çš„é…ç½®
                  progressive: true,
                  quality: 65
                },
                optipng: { // ä½¿ç”¨ imagemin-optipng å‹ç¼© pngï¼Œenable: false ä¸ºå…³é—­
                  enabled: false,
                },
                pngquant: { // ä½¿ç”¨ imagemin-pngquant å‹ç¼© png
                  quality: '65-90',
                  speed: 4
                },
                gifsicle: { // å‹ç¼© gif çš„é…ç½®
                  interlaced: false,
                },
                webp: { // å¼€å¯ webpï¼Œä¼šæŠŠ jpg å’Œ png å›¾ç‰‡å‹ç¼©ä¸º webp æ ¼å¼
                  quality: 75
                },
              },
            },
          ],
        },
      ],
    },
  
    optimization: {
      splitChunks: {
        cacheGroups: {
          vendor: {
            chunks: "initial",
            test: path.resolve(__dirname, "node_modules"), // è·¯å¾„åœ¨ node_modules ç›®å½•ä¸‹çš„éƒ½ä½œä¸ºå…¬å…±éƒ¨åˆ†
            name: "vendor", // ä½¿ç”¨ vendor å…¥å£ä½œä¸ºå…¬å…±éƒ¨åˆ†
            enforce: true,
          },
        },
      },
    },
  
    plugins: [
      new HtmlWebpackPlugin({
        filename: 'index.html', // é…ç½®è¾“å‡ºæ–‡ä»¶åå’Œè·¯å¾„
        template: 'src/index.html', // é…ç½®æ–‡ä»¶æ¨¡æ¿
        minify: { // å‹ç¼© HTML çš„é…ç½®
          minifyCSS: true, // å‹ç¼© HTML ä¸­å‡ºç°çš„ CSS ä»£ç 
          minifyJS: true, // å‹ç¼© HTML ä¸­å‡ºç°çš„ JS ä»£ç 
          removeComments: true,
        },
      }),
      new ExtractTextPlugin('[name].css'),
      new webpack.NamedModulesPlugin(),
      new webpack.HotModuleReplacementPlugin(),
    ],
  
    devServer: {
      hot: true
    }
  }
  ```

## åˆ›å»ºä¸€ä¸ªç®€å•webpackåº”ç”¨

- ç”Ÿæˆpackage.jsonæ–‡ä»¶

  ```js
  {
    "name": "webpack_test",
    "version": "1.0.0"
  }
  ```

- å®‰è£…webpack

  - npm install webpack -g  //å…¨å±€å®‰è£…
  - npm install webpack --save-dev  //å±€éƒ¨å®‰è£…
  - æ ¹æ®package.jsonæ–‡ä»¶ä¸‹è½½ç›¸åº”ç‰ˆæœ¬çš„webpack
  - npm install webpack@1 â€“save-dev

- ç¼–è¯‘æ‰“åŒ…åº”ç”¨

  - åˆ›å»ºå…¥å£src/js/ : entry.js

    ```js
    document.write("entry.js is working");
    ```

  - åˆ›å»ºä¸»é¡µé¢: dist/index.html

    ```html
    <script
    type="text/javascript" src="bundle.js"></script>
    ```

  - ç¼–è¯‘js

    ```npm
    webpack src/js/entry.js dist/bundle.js 
    ```

  - æ‰“åŒ…jsï¼ŒæŒ‡å®šè¾“å‡ºè·¯å¾„

  - ä¸gruntå’Œgulpä¸åŒï¼Œæ‰“åŒ…åŠŸèƒ½ï¼ˆåˆå¹¶åŠŸèƒ½ï¼‰ï¼Œé€šè¿‡é…ç½®æ–‡ä»¶ç®€åŒ–æµç¨‹

    ```js
    // åˆ›å»ºç¬¬äºŒä¸ªjs: src/js/math.js
    export function square(x) {
    return x * x;
    }
    
    export function cube(x) {
    return x * x * x;
    }
    // åˆ›å»ºjsonæ–‡ä»¶: src/json/data.json
    {
    "name": "Tom",
    "age": 12
    }
    // æ›´æ–°å…¥å£js : entry.js
    import {cube} from './math'
    import data from '../json/data.json'
    // æ³¨æ„dataä¼šè‡ªåŠ¨è¢«è½¬æ¢ä¸ºåŸç”Ÿçš„jså¯¹è±¡æˆ–è€…æ•°ç»„
    document.write("entry.js is work <br/>");
    document.write(cube(2) + '<br/>');
    document.write(JSON.stringify(data) + '<br/>')
    // ç¼–è¯‘js:
    webpack src/js/entry.js dist/bundle.js
    // æŸ¥çœ‹é¡µé¢æ•ˆæœ
    ```

  - ![1553436852144](F:\OneDrive\JS\assets\1553436852144.png) 

- ä½¿ç”¨webpacké…ç½®æ–‡ä»¶

  - åˆ›å»ºwebpack.config.js

    ```js
    const path = require('path'); //pathå†…ç½®çš„æ¨¡å—ï¼Œç”¨æ¥è®¾ç½®è·¯å¾„ã€‚
    
    module.exports = {
      entry: './src/js/entry.js',   // å…¥å£æ–‡ä»¶ï¼ˆä¸»æ–‡ä»¶ï¼‰
      output: {                     // è¾“å‡ºé…ç½®
        filename: 'bundle.js',      // è¾“å‡ºæ–‡ä»¶å
    pubulicPath:â€™js/â€™  //è®¾ç½®ä¸ºindex.htmlæä¾›èµ„æºæœåŠ¡çš„åœ°å€ï¼ˆå¼ºåˆ¶æ€§ï¼‰ä¼šå½±å“åˆ°çƒ­åŠ è½½çš„é…ç½®ï¼Œä¸æ¨èä½¿ç”¨
        path: path.resolve(__dirname, 'dist')   //è¾“å‡ºæ–‡ä»¶è·¯å¾„é…ç½®
      }
    };
    ```

  - webpackæ‰§è¡Œæ—¶ä¼šé¦–å…ˆè¯»å–é…ç½®æ–‡ä»¶ï¼Œé…ç½®æ–‡ä»¶è®¾ç½®å¥½åï¼Œç›´æ¥è¾“å…¥webpackå³å¯æ‰§è¡Œæ‰“åŒ…

- é…ç½®npmå‘½ä»¤: package.json

  ```js
  scripts": {
    "build": "webpack"
  },
  ```

  ```npm
  npm run build
  ```

### å›¾ç‰‡

### ä¸ºä»€ä¹ˆåœ¨JavaScriptä¸­åŠ è½½å›¾ç‰‡ä¸èƒ½ç›´æ¥è¯†åˆ«å›¾ç‰‡è·¯å¾„

å› ä¸ºåœ¨webpackä¸­ï¼Œé™¤äº†jsç±»å‹çš„æ–‡ä»¶æ˜¯èƒ½å¤Ÿç›´æ¥è¢«è¯†åˆ«å¹¶æ‰“åŒ…ï¼Œå…¶ä»–ç±»å‹æ–‡ä»¶ï¼ˆcssã€å›¾ç‰‡ç­‰ï¼‰åˆ™éœ€è¦é€šè¿‡ç‰¹å®šçš„loaderæ¥è¿›è¡ŒåŠ è½½æ‰“åŒ…ï¼Œè€Œå›¾ç‰‡åˆ™éœ€è¦ç”¨åˆ°file-loaderæˆ–url-loaderã€‚

åœ¨JavaScriptä¸­å¼•å…¥å›¾ç‰‡è·¯å¾„æ—¶ï¼Œwebpackå¹¶ä¸çŸ¥é“å®ƒæ˜¯ä¸€å¼ å›¾ç‰‡ï¼Œæ‰€ä»¥éœ€è¦å…ˆç”¨requireå°†å›¾ç‰‡èµ„æºåŠ è½½è¿›æ¥ï¼Œç„¶åå†ä½œä¸ºå›¾ç‰‡è·¯å¾„æ·»åŠ åˆ°å¯¹è±¡ä¸Šã€‚

url-loaderå’Œfile-loaderåŠŸèƒ½åŸºæœ¬ä¸€è‡´ï¼Œåªä¸è¿‡url-loaderèƒ½å°†å°äºæŸä¸ªå¤§å°ï¼ˆå¯ä»¥è‡ªå®šä¹‰é…ç½®ï¼‰çš„å›¾ç‰‡è¿›è¡Œbase64æ ¼å¼çš„è½¬åŒ–å¤„ç†ã€‚

å‚è€ƒï¼šhttps://juejin.im/post/5c6515c8e51d456d9574d868

- æ‰“åŒ…csså’Œå›¾ç‰‡æ–‡ä»¶

  - å®‰è£…æ ·å¼çš„loader

  - ```js
    npm install css-loader style-loader --save-dev //css
    npm install file-loader url-loader --save-dev   //å›¾ç‰‡
    // è¡¥å……ï¼šurl-loaderæ˜¯å¯¹è±¡file-loaderçš„ä¸Šå±‚å°è£…ï¼Œä½¿ç”¨æ—¶éœ€é…åˆfile-loaderä½¿ç”¨ã€‚
    ```

  - ç›´æ¥å¼•å…¥cssæ–‡ä»¶ï¼ˆä¸€èµ·æ‰“åŒ…ä¼šæŠ¥é”™ï¼Œéœ€è¦loaderï¼‰ï¼Œ

  - css in js

  - ```js
    import '../css/test.css';
    ```

  - é…ç½®loader

  - ```js
    module: {
      rules: [
        {
          test: /\.css$/,  //ä»¥.cssç»“å°¾ \. è½¬ä¹‰ç­‰äº.
          use: [
            'style-loader', //æŠŠåŠ è½½åˆ°çš„cssæ·»åŠ åˆ°styleæ ‡ç­¾ä¸­
            'css-loader'   //åªèƒ½åŠ è½½cssï¼Œä¸èƒ½æ·»åŠ åˆ°htmlä¸­
          ]
        },
        {
          test: /\.(png|jpg|gif)$/,
          use: [
            {
              loader: 'url-loader',
              options: {
                limit: 8192     //å°äº8kbçš„å›¾ç‰‡ä»¥base64å½¢å¼æ‰“åŒ…åˆ°JSå†…ï¼Œå¯ä»¥å‡å°‘è¯·æ±‚æ¬¡æ•°
              }
            }
          ]
        }
      ]
    }
    ```

  - æ‰“åŒ…å›¾ç‰‡å‡ºç°çš„é—®é¢˜ï¼š

    - å¤§å›¾æ— æ³•æ‰“åŒ…åˆ°entry.jsæ–‡ä»¶ä¸­ï¼Œindex.htmlä¸åœ¨ç”Ÿæˆèµ„æºç›®å½•ä¸‹ã€‚
    - é¡µé¢åŠ è½½å›¾ç‰‡ä¼šåœ¨æ‰€åœ¨ç›®å½•ä½ç½®æŸ¥æ‰¾ï¼Œå¯¼è‡´é¡µé¢åŠ è½½å›¾ç‰‡æ—¶å€™å¤§å›¾è·¯å¾„æ— æ³•æ‰¾åˆ°
    - è§£å†³åŠæ³•ï¼š
    - ä½¿ç”¨publicPath : 'dist/js/' //è®¾ç½®ä¸ºindex.htmlæä¾›èµ„æºçš„è·¯å¾„,è®¾ç½®å®Œåæ‰¾æ‰€æœ‰çš„èµ„æºéƒ½ä¼šå»å½“å‰ç›®å½•ä¸‹æ‰¾ã€‚
    - å°†index.htmlæ”¾åœ¨dist/js/ä¹Ÿå¯ä»¥è§£å†³ã€‚

- è‡ªåŠ¨ç¼–è¯‘æ‰“åŒ…ï¼ˆæŒ‡å—â†’å¼€å‘ï¼‰

  - åˆ©ç”¨webpackå¼€å‘æœåŠ¡å™¨å·¥å…·: webpack-dev-server

  - ä¸‹è½½

    - npm install --save-dev webpack-dev-server
    - ä¸‹è½½å®Œä¹‹åå¤šå‡ºä¸€ä¸ªwebpack-dev-serverå‘½ä»¤ï¼Œä¹Ÿæ˜¯å†…ç½®ä¸€ä¸ªå¾®å‹æœåŠ¡å™¨ï¼Œè‡ªåŠ¨è¯»å–webpacké…ç½®æ–‡ä»¶
    - è®¿é—®localhost:8080ï¼Œå¯ä»¥çœ‹åˆ°å½“å‰çš„é¡¹ç›®
    - webpack-dev-serveré»˜è®¤æœåŠ¡äº**æ ¹ç›®å½•**ä¸‹çš„**index.html**
    - æ ¹ç›®å½•ä»¥é…ç½®æ–‡ä»¶ä¸ºåŸºå‡†ï¼Œæ‰€ä»¥index.htmlç›´æ¥æ”¾åœ¨é…ç½®æ–‡ä»¶æ—è¾¹ï¼Œå¯ä»¥ä¸è®¾ç½®contenBaseå±æ€§ï¼Œä¸”æ–‡ä»¶åå›ºå®šçš„
    - çƒ­åŠ è½½ä¼šè‡ªåŠ¨å¯»æ‰¾æ‰“åŒ…åçš„å¤§å›¾ç‰‡ï¼Œçƒ­åŠ è½½ç”Ÿæˆçš„æ–‡ä»¶éƒ½åœ¨å¾®å‹æœåŠ¡å™¨çš„å†…å­˜é‡Œï¼Œä¸æœ¬åœ°æ–‡ä»¶æ— å…³
    - webpack-dev-serverâ€”open

  - webpack.config.jsé…ç½®

    ```js
    devServer: {
      contentBase: './dist'
    },
    ```

  - package.jsoné…ç½®

    ```json
    "start": "webpack-dev-server --open"
    ```

- ä½¿ç”¨webpackæ’ä»¶

  - å¸¸ç”¨çš„æ’ä»¶

  - ä½¿ç”¨html-webpack-pluginæ ¹æ®æ¨¡æ¿htmlç”Ÿæˆå¼•å…¥scriptçš„é¡µé¢

  - ä½¿ç”¨clean-webpack-pluginæ¸…é™¤distæ–‡ä»¶å¤¹

  - ä¸‹è½½

    ```npm
    npm install --save-dev  html-webpack-plugin clean-webpack-plugin
    ```

  - webpacké…ç½®

    ```js
    const HtmlWebpackPlugin = require('html-webpack-plugin'); //è‡ªåŠ¨ç”Ÿæˆhtmlæ–‡ä»¶çš„æ’ä»¶
     const CleanWebpackPlugin = require('clean-webpack-plugin'); //æ¸…é™¤ä¹‹å‰æ‰“åŒ…çš„æ–‡ä»¶   
    plugins: [
      new HtmlWebpackPlugin({template: './index.html'}),
      new CleanWebpackPlugin(['dist']),
    ]
    ```

  - åˆ›å»ºé¡µé¢: index.html

    ```html
    <!DOCTYPE html>
    <html lang="en">
    <head>
      <meta charset="UTF-8">
      <title>webpack test</title>
    </head>
    <body>
    <div id="app"></div>
    <!--æ‰“åŒ…æ–‡ä»¶å°†è‡ªåŠ¨é€šè¿‡scriptæ ‡ç­¾æ³¨å…¥åˆ°æ­¤å¤„-->
    </body>
    </html>
    ```

- çƒ­åŠ è½½å’Œhtmlçš„æ’ä»¶

  - çƒ­åŠ è½½æ‰¾åˆ°index.htmlä¹‹ååœ¨è‡ªå·±çš„å¾®å‹æœåŠ¡å™¨å†…å­˜é‡Œé¢æ“ä½œï¼Œä¸ä¼šç”Ÿäº§é™æ€çš„æ–‡ä»¶
  - htmlæ’ä»¶åˆ™æ˜¯ä»¥index.htmlä¸ºæ¨¡æ¿åœ¨æŒ‡å®šç›®å½•ç”Ÿäº§æ‰€æœ‰çš„é™æ€æ–‡ä»¶ï¼Œcssåœ¨js é‡Œé¢æ‰“åŒ…ï¼Œå¤§çš„å›¾ç‰‡åŒä¸€è·¯å¾„ï¼Œå°çš„å›¾ç‰‡ä¹Ÿåœ¨jsé‡Œé¢ï¼Œç„¶åç”Ÿäº§çš„index.htmlç›´æ¥å¼•ç”¨åŒä¸€è·¯å¾„çš„js
  - çƒ­åŠ è½½ç”¨webpack-dev-serverå¼€å¯
  - htmlæ’ä»¶å’Œæ™®é€šçš„æ‰“åŒ…ç¼–è¯‘å‹ç¼©ä¸€æ ·ç”¨webpackåŒä¸€æ‰§è¡Œ
  - è°ƒè¯•åœ¨webpack-dev-serverè¿›è¡Œï¼Œç»“æŸåç”¨webpackç”Ÿäº§æ‰€æœ‰é™æ€æ–‡ä»¶

# é¡¹ç›®çš„æ‰“åŒ…ä¸å‘å¸ƒ

+ æ‰“åŒ…ï¼š`npm run build`

+ å‘å¸ƒ 1: ä½¿ç”¨é™æ€æœåŠ¡å™¨å·¥å…·åŒ…

  ```js
  npm install -g serve
  serve dist
  ```

+ è®¿é—®: <http://localhost:5000>

+ ç”¨åŠ¨æ€ web æœåŠ¡å™¨(tomcat)

+ ä½¿ç”¨é™æ€æœåŠ¡å™¨ https://www.cnblogs.com/greenteaone/p/10083129.html
